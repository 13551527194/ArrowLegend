{
  "code": "import GameConfig from \"./GameConfig\";\r\nimport GameBG from \"./game/GameBG\";\r\nimport GameMain from \"./main/GameMain\";\r\nimport { ui } from \"./ui/layaMaxUI\";\r\nimport App from \"./core/App\";\r\nimport LoginHttp from \"./net/LoginHttp\";\r\nimport ReceiverHttp from \"./net/ReceiverHttp\";\r\nimport PlatformID from \"./platforms/PlatformID\";\r\nimport HitType from \"./game/ai/HitType\";\r\nimport GameScaleAnimator1 from \"./game/ai/GameScaleAnimator1\";\r\nimport GameScaleAnimator2 from \"./game/ai/GameScaleAnimator2\";\r\nimport GameScaleAnimator3 from \"./game/ai/GameScaleAnimator3\";\r\nimport GameScaleAnimator4 from \"./game/ai/GameScaleAnimator4\";\r\nimport NPC_1001 from \"./main/scene/battle/npc/NPC_1001\";\r\nimport NPC_1002 from \"./main/scene/battle/npc/NPC_1002\";\r\nimport NPC_1003 from \"./main/scene/battle/npc/NPC_1003\";\r\nimport AttackType from \"./game/ai/AttackType\";\r\nimport AIType from \"./game/ai/AIType\";\r\nimport BaseAI from \"./game/ai/BaseAi\";\r\nimport FlyAndHitAi from \"./game/ai/FlyAndHitAi\";\r\nimport FlowerAI from \"./game/ai/FlowerAI\";\r\nimport StoneAI from \"./game/ai/StoneAI\";\r\nimport TreeAI from \"./game/ai/TreeAI\";\r\nimport RandMoveAI from \"./game/ai/RandMoveAI\";\r\nimport MoveAndHitAi from \"./game/ai/MoveAndHitAi\";\r\nimport ReboundAI from \"./game/ai/ReboundAI\";\r\nimport JumpFollowAI from \"./game/ai/JumpFollowAI\";\r\nimport ArcherAI from \"./game/ai/ArcherAI\";\r\nimport MoveType from \"./game/move/MoveType\";\r\nimport FlyGameMove from \"./game/move/FlyGameMove\";\r\nimport PlaneGameMove from \"./game/move/PlaneGameMove\";\r\nimport FixedGameMove from \"./game/move/FixedGameMove\";\r\nimport JumpMove from \"./game/move/JumpMove\";\r\nimport BackMove from \"./game/move/BackMove\";\r\nimport TestPlatform from \"./platforms/TestPlatform\";\r\nimport WXPlatform from \"./platforms/WXPlatform\";\r\nimport BuffID from \"./game/buff/BuffID\";\r\nimport FireBuff from \"./game/skill/player/FireBuff\";\r\nimport IceBuff from \"./game/skill/player/IceBuff\";\r\nimport Game from \"./game/Game\";\r\nimport WudiBuff from \"./game/skill/player/WudiBuff\";\r\nimport ShitouAI from \"./game/ai/ShitouAI\";\r\nimport FlyGameMove2 from \"./game/move/FlyGameMove2\";\r\nimport TestCookie from \"./gameCookie/TestCookie\";\r\nimport WXCookie from \"./gameCookie/WXCookie\";\r\nimport CookieKey from \"./gameCookie/CookieKey\";\r\nimport MyEffect from \"./core/utils/MyEffect\";\r\nimport Session from \"./main/Session\";\r\nclass Main {\r\n    constructor() {\r\n        this.isSuccess = false;\r\n        this.isInit = false;\r\n        if (window[\"Laya3D\"])\r\n            Laya3D.init(GameConfig.width, GameConfig.height);\r\n        else\r\n            Laya.init(GameConfig.width, GameConfig.height, Laya[\"WebGL\"]);\r\n        Laya[\"Physics\"] && Laya[\"Physics\"].enable();\r\n        Laya.stage.scaleMode = GameConfig.scaleMode;\r\n        Laya.stage.screenMode = GameConfig.screenMode;\r\n        Laya.URL.exportSceneToJson = GameConfig.exportSceneToJson;\r\n        if (GameConfig.stat)\r\n            Laya.Stat.show();\r\n        if (Laya.Browser.window.wx) {\r\n            Laya.URL.basePath = \"https://img.kuwan511.com/arrowLegend/\" + Game.resVer + \"/\";\r\n            Laya.MiniAdpter.nativefiles = [\"loading/jiazai.jpg\", \"loading/btn_kaishi.png\", \"loading/loadingClip.png\", \"allJson.json\"];\r\n            Laya.Browser.window.wx.getSystemInfo({\r\n                success(res) {\r\n                    let model = res.model;\r\n                    if (model.search('iPhone X') != -1) {\r\n                        App.top = 90;\r\n                    }\r\n                    GameBG.height = GameBG.width / res.windowWidth * res.windowHeight;\r\n                }\r\n            });\r\n        }\r\n        if (Laya.Browser.onMiniGame == false) {\r\n            Laya.stage.scaleMode = Laya.Stage.SCALE_SHOWALL;\r\n            Laya.stage.alignH = \"center\";\r\n        }\r\n        this._initView = new ui.test.initViewUI();\r\n        Laya.stage.addChild(this._initView);\r\n        this._initView.initTxt.text = \"0%\";\r\n        Laya.loader.load([\"h5/config.json\", \"loading/loadingClip.png\", \"loading/jiazai.jpg\", \"loading/btn_kaishi.png\",], new Laya.Handler(this, this.onInitCom), new Laya.Handler(this, this.onInitProgress));\r\n        App.init();\r\n        MyEffect.initBtnEffect();\r\n        Session.init();\r\n    }\r\n    onInitProgress(value) {\r\n        value = value * 100;\r\n        this._initView.initTxt.text = \"\" + value.toFixed(0) + \"%\";\r\n    }\r\n    onInitCom() {\r\n        this.regClass();\r\n        let config = Laya.loader.getRes(\"h5/config.json\");\r\n        console.log(\"config---\", config);\r\n        App.platformId = config.platformId;\r\n        App.serverIP = config.platforms[App.platformId];\r\n        if (!this.homePage) {\r\n            this.homePage = new ui.game.homePageUI();\r\n        }\r\n        Laya.stage.addChild(this.homePage);\r\n        let bc;\r\n        if (App.platformId != PlatformID.WX) {\r\n            bc = new TestCookie();\r\n        }\r\n        else if (App.platformId == PlatformID.WX) {\r\n            bc = new WXCookie();\r\n        }\r\n        Game.cookie = bc;\r\n        Game.cookie.getCookie(CookieKey.USER_ID, (res) => {\r\n            if (res == null) {\r\n            }\r\n            else {\r\n                App.soundManager.setMusicVolume(res.state);\r\n                this.homePage.vvv.t1.text = res.userId;\r\n            }\r\n        });\r\n        App.soundManager.pre = \"h5/sounds/\";\r\n        Laya.stage.addChild(App.layerManager);\r\n        Game.cookie.getCookie(CookieKey.MUSIC_SWITCH, (res) => {\r\n            if (res == null) {\r\n                Game.cookie.setCookie(CookieKey.MUSIC_SWITCH, { \"state\": 1 });\r\n                App.soundManager.setMusicVolume(1);\r\n            }\r\n            else {\r\n                App.soundManager.setMusicVolume(res.state);\r\n            }\r\n        });\r\n        Game.cookie.getCookie(CookieKey.SOUND_SWITCH, (res) => {\r\n            if (res == null) {\r\n                Game.cookie.setCookie(CookieKey.SOUND_SWITCH, { \"state\": 1 });\r\n                App.soundManager.setSoundVolume(1);\r\n            }\r\n            else {\r\n                App.soundManager.setSoundVolume(res.state);\r\n            }\r\n        });\r\n        Game.playBgMusic();\r\n        this.authSetting();\r\n    }\r\n    authSetting() {\r\n        this._initView && this._initView.removeSelf();\r\n        let BP = Laya.ClassUtils.getRegClass(\"p\" + App.platformId);\r\n        if (!this.curBP) {\r\n            this.curBP = new BP();\r\n        }\r\n        this.homePage.vvv.visible = (App.platformId == PlatformID.TEST || App.platformId == PlatformID.H5);\r\n        this.curBP.getUserInfo(this.getUserInfoSuccess.bind(this));\r\n    }\r\n    getUserInfoSuccess() {\r\n        if (this.isSuccess) {\r\n            return;\r\n        }\r\n        this.isSuccess = true;\r\n        console.log(\"授权成功，开始加载\");\r\n        this.homePage && this.homePage.removeSelf();\r\n        this.loading = new ui.test.LoadingUI();\r\n        this.loading.mouseEnabled = true;\r\n        Laya.stage.addChild(this.loading);\r\n        this.loading.txt.text = \"0%\";\r\n        Laya.loader.load([\r\n            { url: \"res/atlas/main.atlas\", type: Laya.Loader.ATLAS },\r\n            { url: \"res/atlas/guide.atlas\", type: Laya.Loader.ATLAS },\r\n            { url: \"res/atlas/zhaohuan.atlas\", type: Laya.Loader.ATLAS },\r\n            { url: \"h5/tables.zip\", type: Laya.Loader.BUFFER }\r\n        ], new Laya.Handler(this, this.onHandler), new Laya.Handler(this, this.onProgress));\r\n    }\r\n    onHandler() {\r\n        console.log(\"加载完成\");\r\n        this.curBP.checkUpdate();\r\n        new LoginHttp(new Laya.Handler(this, this.onSuccess)).checkLogin();\r\n    }\r\n    onSuccess(data) {\r\n        console.log(\"登录成功\");\r\n        ReceiverHttp.create(new Laya.Handler(this, this.onReceive)).send();\r\n    }\r\n    onReceive(data) {\r\n        if (this.isInit) {\r\n            return;\r\n        }\r\n        console.log(\"获取玩家数据成功\");\r\n        this.isInit = true;\r\n        new GameMain();\r\n        this.loading.removeSelf();\r\n    }\r\n    onProgress(value) {\r\n        value = value * 100;\r\n        this.loading.txt.text = \"\" + value.toFixed(0) + \"%\";\r\n    }\r\n    regClass() {\r\n        var REG = Laya.ClassUtils.regClass;\r\n        REG(\"HIT_\" + HitType.hit1, GameScaleAnimator1);\r\n        REG(\"HIT_\" + HitType.hit2, GameScaleAnimator2);\r\n        REG(\"HIT_\" + HitType.hit3, GameScaleAnimator4);\r\n        REG(\"HIT_\" + HitType.hit4, GameScaleAnimator3);\r\n        REG(\"NPC1001\", NPC_1001);\r\n        REG(\"NPC1002\", NPC_1002);\r\n        REG(\"NPC1003\", NPC_1003);\r\n        REG(AttackType.TAG + AIType.NOTHAS, BaseAI);\r\n        REG(AttackType.TAG + AIType.FLYHIT, FlyAndHitAi);\r\n        REG(AttackType.TAG + AIType.BULLET, FlowerAI);\r\n        REG(AttackType.TAG + AIType.STONE, StoneAI);\r\n        REG(AttackType.TAG + AIType.SHITOUREN, ShitouAI);\r\n        REG(AttackType.TAG + AIType.TREE, TreeAI);\r\n        REG(AttackType.TAG + AIType.RANDOM_MOVE, RandMoveAI);\r\n        REG(AttackType.TAG + AIType.MOVEHIT, MoveAndHitAi);\r\n        REG(AttackType.TAG + AIType.REBOUND, ReboundAI);\r\n        REG(AttackType.TAG + AIType.JUMP_FOLLOW, JumpFollowAI);\r\n        REG(AttackType.TAG + AIType.RED_LINE, ArcherAI);\r\n        REG(MoveType.TAG + MoveType.FLY, FlyGameMove);\r\n        REG(MoveType.TAG + MoveType.MOVE, PlaneGameMove);\r\n        REG(MoveType.TAG + MoveType.FIXED, FixedGameMove);\r\n        REG(MoveType.TAG + MoveType.JUMP, JumpMove);\r\n        REG(MoveType.TAG + MoveType.BACK, BackMove);\r\n        REG(MoveType.TAG + MoveType.BOOM, FlyGameMove2);\r\n        REG(\"p\" + PlatformID.TEST, TestPlatform);\r\n        REG(\"p\" + PlatformID.H5, TestPlatform);\r\n        REG(\"p\" + PlatformID.WX, WXPlatform);\r\n        REG(\"BUFF\" + BuffID.WUDI_5009, WudiBuff);\r\n        REG(\"BUFF\" + BuffID.FIRE_2001, FireBuff);\r\n        REG(\"BUFF\" + BuffID.FIRE_5001, FireBuff);\r\n        REG(\"BUFF\" + BuffID.DU_2002, FireBuff);\r\n        REG(\"BUFF\" + BuffID.DU_5002, FireBuff);\r\n        REG(\"BUFF\" + BuffID.ICE_2003, IceBuff);\r\n        REG(\"BUFF\" + BuffID.ICE_5003, IceBuff);\r\n    }\r\n}\r\nnew Main();\r\n",
  "references": [
    "D:/gitworker/Game3DUP/src/GameConfig.ts",
    "D:/gitworker/Game3DUP/src/game/GameBG.ts",
    "D:/gitworker/Game3DUP/src/main/GameMain.ts",
    "D:/gitworker/Game3DUP/src/ui/layaMaxUI.ts",
    "D:/gitworker/Game3DUP/src/core/App.ts",
    "D:/gitworker/Game3DUP/src/net/LoginHttp.ts",
    "D:/gitworker/Game3DUP/src/net/ReceiverHttp.ts",
    "D:/gitworker/Game3DUP/src/platforms/PlatformID.ts",
    "D:/gitworker/Game3DUP/src/platforms/BasePlatform.ts",
    "D:/gitworker/Game3DUP/src/game/ai/HitType.ts",
    "D:/gitworker/Game3DUP/src/game/ai/GameScaleAnimator1.ts",
    "D:/gitworker/Game3DUP/src/game/ai/GameScaleAnimator2.ts",
    "D:/gitworker/Game3DUP/src/game/ai/GameScaleAnimator3.ts",
    "D:/gitworker/Game3DUP/src/game/ai/GameScaleAnimator4.ts",
    "D:/gitworker/Game3DUP/src/main/scene/battle/npc/NPC_1001.ts",
    "D:/gitworker/Game3DUP/src/main/scene/battle/npc/NPC_1002.ts",
    "D:/gitworker/Game3DUP/src/main/scene/battle/npc/NPC_1003.ts",
    "D:/gitworker/Game3DUP/src/game/ai/AttackType.ts",
    "D:/gitworker/Game3DUP/src/game/ai/AIType.ts",
    "D:/gitworker/Game3DUP/src/game/ai/BaseAi.ts",
    "D:/gitworker/Game3DUP/src/game/ai/FlyAndHitAi.ts",
    "D:/gitworker/Game3DUP/src/game/ai/FlowerAI.ts",
    "D:/gitworker/Game3DUP/src/game/ai/StoneAI.ts",
    "D:/gitworker/Game3DUP/src/game/ai/TreeAI.ts",
    "D:/gitworker/Game3DUP/src/game/ai/RandMoveAI.ts",
    "D:/gitworker/Game3DUP/src/game/ai/MoveAndHitAi.ts",
    "D:/gitworker/Game3DUP/src/game/ai/ReboundAI.ts",
    "D:/gitworker/Game3DUP/src/game/ai/JumpFollowAI.ts",
    "D:/gitworker/Game3DUP/src/game/ai/ArcherAI.ts",
    "D:/gitworker/Game3DUP/src/game/move/MoveType.ts",
    "D:/gitworker/Game3DUP/src/game/move/FlyGameMove.ts",
    "D:/gitworker/Game3DUP/src/game/move/PlaneGameMove.ts",
    "D:/gitworker/Game3DUP/src/game/move/FixedGameMove.ts",
    "D:/gitworker/Game3DUP/src/game/move/JumpMove.ts",
    "D:/gitworker/Game3DUP/src/game/move/BackMove.ts",
    "D:/gitworker/Game3DUP/src/platforms/TestPlatform.ts",
    "D:/gitworker/Game3DUP/src/platforms/WXPlatform.ts",
    "D:/gitworker/Game3DUP/src/game/buff/BuffID.ts",
    "D:/gitworker/Game3DUP/src/game/skill/player/FireBuff.ts",
    "D:/gitworker/Game3DUP/src/game/skill/player/IceBuff.ts",
    "D:/gitworker/Game3DUP/src/game/Game.ts",
    "D:/gitworker/Game3DUP/src/game/skill/player/WudiBuff.ts",
    "D:/gitworker/Game3DUP/src/game/ai/ShitouAI.ts",
    "D:/gitworker/Game3DUP/src/game/move/FlyGameMove2.ts",
    "D:/gitworker/Game3DUP/src/gameCookie/TestCookie.ts",
    "D:/gitworker/Game3DUP/src/gameCookie/WXCookie.ts",
    "D:/gitworker/Game3DUP/src/gameCookie/BaseCookie.ts",
    "D:/gitworker/Game3DUP/src/gameCookie/CookieKey.ts",
    "D:/gitworker/Game3DUP/src/core/utils/MyEffect.ts",
    "D:/gitworker/Game3DUP/src/main/Session.ts"
  ]
}
