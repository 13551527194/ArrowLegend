{
  "code": "import GameEvent from \"../../main/GameEvent\";\r\nimport { TopUI } from \"../../main/scene/main/MainUI\";\r\nimport Game from \"../Game\";\r\nimport App from \"../../core/App\";\r\nimport SysHero from \"../../main/sys/SysHero\";\r\nexport default class HomeData {\r\n    constructor() {\r\n        this.redDiamond = 0;\r\n        this.blueDiamond = 0;\r\n        this.playerExp = 0;\r\n    }\r\n    setData(data) {\r\n        this.totalEnergy = data.totalEnergy;\r\n        this.maxEngergy = data.maxEngergy;\r\n        this.lastTime = data.lastTime;\r\n        this.curEnergy = data.curEnergy;\r\n        this.chapterId = data.chapterId;\r\n        this.mapIndex = data.mapIndex;\r\n        this.level = data.level;\r\n        this.coins = data.coins;\r\n        this.playerExp = data.playerExp;\r\n        if (this.playerExp == null) {\r\n            this.playerExp = 0;\r\n        }\r\n        if (Date.now() >= this.lastTime) {\r\n            this.curEnergy = this.totalEnergy;\r\n        }\r\n        else {\r\n            let deltaTime = this.lastTime - Date.now();\r\n            let time = Math.floor(deltaTime / 1000);\r\n            let delta = Math.ceil(time / TopUI.TOTAL_TIME);\r\n            this.curEnergy = this.totalEnergy - delta;\r\n            console.log(\"Session剩余的时间\", time, this.curEnergy);\r\n        }\r\n    }\r\n    saveData(data) {\r\n        data.curEnergy = this.curEnergy;\r\n        data.maxEngergy = this.maxEngergy;\r\n        data.lastTime = this.lastTime;\r\n        data.totalEnergy = this.totalEnergy;\r\n        data.chapterId = this.chapterId;\r\n        data.mapIndex = this.mapIndex;\r\n        data.level = this.level;\r\n        data.coins = this.coins;\r\n        data.playerExp = this.playerExp;\r\n        if (Game.battleLoader.index > this.mapIndex) {\r\n            data.mapIndex = Game.battleLoader.index;\r\n            console.log(\"存储最高层数\", data.mapIndex);\r\n        }\r\n        data.coins += Game.addCoins;\r\n        this.coins = data.coins;\r\n        data.level = this.level;\r\n    }\r\n    initData(data) {\r\n        this.totalEnergy = TopUI.MAX_ENERGY;\r\n        this.maxEngergy = TopUI.MAX_ENERGY;\r\n        this.curEnergy = this.totalEnergy;\r\n        this.lastTime = 0;\r\n        this.chapterId = 1;\r\n        this.mapIndex = 0;\r\n        this.level = 1;\r\n        this.coins = 0;\r\n        this.redDiamond = 0;\r\n        this.playerExp = 0;\r\n        this.blueDiamond = 0;\r\n    }\r\n    changeGold(type, value, useType = 0) {\r\n        let num = this.getGoldByType(type);\r\n        if ((num + value) < 0) {\r\n            return false;\r\n        }\r\n        this.setGoldByType(type, value);\r\n        Laya.stage.event(GameEvent.GOLD_CHANGE);\r\n        return true;\r\n    }\r\n    getGoldByType(type) {\r\n        if (type == GoldType.GOLD) {\r\n            return this.coins;\r\n        }\r\n        else if (type == GoldType.RED_DIAMONG) {\r\n            return this.redDiamond;\r\n        }\r\n        else if (type == GoldType.BLUE_DIAMONG) {\r\n            return this.blueDiamond;\r\n        }\r\n    }\r\n    setGoldByType(type, value) {\r\n        if (type == GoldType.GOLD) {\r\n            this.coins += value;\r\n        }\r\n        else if (type == GoldType.RED_DIAMONG) {\r\n            this.redDiamond += value;\r\n        }\r\n        else if (type == GoldType.BLUE_DIAMONG) {\r\n            this.blueDiamond += value;\r\n        }\r\n    }\r\n    addPlayerExp(exp) {\r\n        this.playerExp += exp;\r\n        while (true) {\r\n            let sys = App.tableManager.getDataByNameAndId(SysHero.NAME, this.level);\r\n            if (this.playerExp >= sys.roleExp) {\r\n                let nowLv = this.level + 1;\r\n                if (App.tableManager.getDataByNameAndId(SysHero.NAME, this.level) == null) {\r\n                    break;\r\n                }\r\n                this.level = nowLv;\r\n                this.playerExp -= sys.roleExp;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        App.sendEvent(GameEvent.PLAYER_INFO_UPDATE);\r\n    }\r\n}\r\nexport var GoldType;\r\n(function (GoldType) {\r\n    GoldType[GoldType[\"GOLD\"] = 0] = \"GOLD\";\r\n    GoldType[GoldType[\"RED_DIAMONG\"] = 1] = \"RED_DIAMONG\";\r\n    GoldType[GoldType[\"BLUE_DIAMONG\"] = 2] = \"BLUE_DIAMONG\";\r\n})(GoldType || (GoldType = {}));\r\n",
  "references": [
    "D:/gitworker/Game3DUP/src/game/data/IData.ts",
    "D:/gitworker/Game3DUP/src/main/GameEvent.ts",
    "D:/gitworker/Game3DUP/src/main/scene/main/MainUI.ts",
    "D:/gitworker/Game3DUP/src/game/Game.ts",
    "D:/gitworker/Game3DUP/src/UseGoldType.ts",
    "D:/gitworker/Game3DUP/src/core/App.ts",
    "D:/gitworker/Game3DUP/src/main/sys/SysHero.ts"
  ]
}
