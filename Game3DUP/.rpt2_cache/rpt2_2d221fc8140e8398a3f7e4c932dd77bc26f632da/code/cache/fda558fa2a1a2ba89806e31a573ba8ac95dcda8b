{
  "code": "import GameHitBox from \"./GameHitBox\";\r\nimport GameBG from \"./GameBG\";\r\nimport Game from \"./Game\";\r\nimport GameData from \"./GameData\";\r\nimport FootCircle from \"./FootCircle\";\r\nimport GameProType from \"./GameProType\";\r\nimport Blood from \"./Blood\";\r\nimport { GameAI } from \"./ai/GameAI\";\r\nimport BloodEffect from \"./effect/BloodEffect\";\r\nexport default class GamePro extends Laya.EventDispatcher {\r\n    constructor(proType_, hp = 600) {\r\n        super();\r\n        this.buffAry = [];\r\n        this.tScale = 1;\r\n        this.isIce = false;\r\n        this.unBlocking = false;\r\n        this.hurtValue = 0;\r\n        this.speed_ = 6;\r\n        this._pos2 = new Laya.Vector3(0, 0, 0);\r\n        this.moven2d_ = 0;\r\n        this.facen2d_ = 0;\r\n        this.facen3d_ = 0;\r\n        this.acstr_ = \"\";\r\n        this.rotationEulerY = 0;\r\n        this.keyNum = -1;\r\n        this.gamedata_ = new GameData();\r\n        this.gamedata_.hp = this.gamedata_.maxhp = hp;\r\n        this.gamedata_.proType = proType_;\r\n        this.rotationEulerY = 0;\r\n    }\r\n    checkBlackList(ee) {\r\n        if (this.hit_blacklist) {\r\n            let arr = this.hit_blacklist;\r\n            for (let i = 0; i < arr.length; i++) {\r\n                let e = arr[i];\r\n                if (e == ee) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    setShadowSize(ww) {\r\n        this._bulletShadow && this._bulletShadow.img.size(ww, ww);\r\n    }\r\n    removeShodow() {\r\n        this._bulletShadow && this._bulletShadow.removeSelf();\r\n    }\r\n    get bloodUI() {\r\n        return this._bloodUI;\r\n    }\r\n    setKeyNum(n) {\r\n        this.keyNum = n;\r\n    }\r\n    initBlood(hp, maxhp) {\r\n        this.gamedata.hp = hp;\r\n        this.gamedata.maxhp = maxhp;\r\n        if (!this._bloodUI) {\r\n            this._bloodUI = new Blood();\r\n        }\r\n        this._bloodUI.init(this.gamedata_);\r\n        Game.bloodLayer.addChild(this._bloodUI);\r\n        this._bloodUI && this._bloodUI.pos(this.hbox_.cx, this.hbox_.cy - 120);\r\n    }\r\n    addFootCircle() {\r\n        if (!this._footCircle) {\r\n            this._footCircle = new FootCircle();\r\n        }\r\n        Game.footLayer.addChild(this._footCircle);\r\n        this._footCircle && this._footCircle.pos(this.hbox_.cx, this.hbox_.cy);\r\n    }\r\n    hurt(hurt, isCrit) {\r\n        this._bloodUI && this._bloodUI.update(hurt);\r\n        if (hurt > 0) {\r\n            BloodEffect.add(\"-\" + hurt, this._bloodUI, isCrit, isCrit ? \"main/redFont.png\" : \"main/clipshuzi.png\");\r\n        }\r\n    }\r\n    die() {\r\n        this.play(GameAI.Die);\r\n        this.stopAi();\r\n        this._bulletShadow && this._bulletShadow.removeSelf();\r\n        if (Game.map0.Eharr.indexOf(this.hbox) >= 0) {\r\n            Game.map0.Eharr.splice(Game.map0.Eharr.indexOf(this.hbox), 1);\r\n        }\r\n    }\r\n    setSp3d(sp, ww) {\r\n        this.sp3d_ = sp;\r\n        this.sp3d_.transform.localRotationEulerY = this.rotationEulerY = 0;\r\n        this.hbox_ = new GameHitBox(ww ? ww : GameBG.mw, ww ? ww : GameBG.mw);\r\n        this.hbox_.linkPro_ = this;\r\n        this.hbox_.setCenter(GameBG.mcx, GameBG.mcy);\r\n        let aniSprite3d = sp.getChildAt(0);\r\n        if (aniSprite3d) {\r\n            this.ani_ = aniSprite3d.getComponent(Laya.Animator);\r\n        }\r\n        this.on(Game.Event_Hit, this, this.hit);\r\n    }\r\n    get animator() {\r\n        return this.ani_;\r\n    }\r\n    addSprite3DToChild(childName, sprite3d) {\r\n        var ss = this.sp3d.getChildAt(0).getChildByName(childName);\r\n        return ss.addChild(sprite3d);\r\n    }\r\n    addWeapon() {\r\n        this.weapon = Laya.loader.getRes(\"h5/gong/hero.lh\");\r\n        this.addSprite3DToAvatarNode(\"joint14\", this.weapon);\r\n    }\r\n    addSprite3DToAvatarNode(nodeName, sprite3d) {\r\n        var bool = this.ani_.linkSprite3DToAvatarNode(nodeName, sprite3d);\r\n    }\r\n    removeSprite3DToAvatarNode(s3d) {\r\n        this.ani_ && this.ani_.unLinkSprite3DToAvatarNode(s3d);\r\n    }\r\n    hit(pro, isBuff = false) {\r\n        if (this.gameAI) {\r\n            this.gameAI.hit(pro, isBuff);\r\n        }\r\n    }\r\n    closeCombat(pro) {\r\n    }\r\n    get acstr() {\r\n        return this.acstr_;\r\n    }\r\n    set acstr(s) {\r\n        this.acstr_ = s;\r\n    }\r\n    get face2d() {\r\n        return this.facen2d_;\r\n    }\r\n    get face3d() {\r\n        return this.facen3d_;\r\n    }\r\n    get speed() {\r\n        return this.speed_;\r\n    }\r\n    setSpeed(speed) {\r\n        this.speed_ = speed;\r\n    }\r\n    setGameMove(gamemove) {\r\n        this.movef = gamemove;\r\n    }\r\n    getGameMove() {\r\n        return this.movef;\r\n    }\r\n    setGameAi(gameAI) {\r\n        this.gameAI = gameAI;\r\n        return this.gameAI;\r\n    }\r\n    getGameAi() {\r\n        return this.gameAI;\r\n    }\r\n    get hbox() {\r\n        if (!this.hbox_) {\r\n            this.hbox_ = new GameHitBox(GameBG.mw, GameBG.mw);\r\n            this.hbox_.setXY(GameBG.mcx, GameBG.mcy);\r\n        }\r\n        return this.hbox_;\r\n    }\r\n    get sp2d() {\r\n        if (!this.sp2d_) {\r\n            this.sp2d_ = new Laya.Sprite();\r\n            this.sp2d_.graphics.drawRect(0, 0, GameBG.mw, GameBG.mw, null, 0xfff000);\r\n            this.sp2d_.x = this.hbox.x;\r\n            this.sp2d_.y = this.hbox.y;\r\n        }\r\n        return this.sp2d_;\r\n    }\r\n    get sp3d() {\r\n        return this.sp3d_;\r\n    }\r\n    play(actionstr) {\r\n        if (this.acstr == GameAI.Die) {\r\n            return;\r\n        }\r\n        this.acstr_ = actionstr;\r\n        this.ani_.play(actionstr);\r\n        if (this.acstr != GameAI.Run && this.acstr != GameAI.Idle && this.acstr != GameAI.Die) {\r\n            Laya.stage.frameLoop(1, this, this.ac0);\r\n        }\r\n        else {\r\n            Laya.stage.timer.clear(this, this.ac0);\r\n        }\r\n    }\r\n    ac0() {\r\n        if (this.normalizedTime >= 1) {\r\n            var str = this.acstr_;\r\n            Laya.stage.timer.clear(this, this.ac0);\r\n            this.event(Game.Event_PlayStop, str);\r\n            if (str == GameAI.SkillStart) {\r\n                this.play(GameAI.SkillLoop);\r\n            }\r\n            else if (str == GameAI.SkillLoop) {\r\n                this.play(GameAI.SkillLoop);\r\n            }\r\n            else {\r\n                this.play(GameAI.Idle);\r\n            }\r\n        }\r\n    }\r\n    ac1() {\r\n        if (this.keyNum >= 0 && this.normalizedTime >= this.keyNum) {\r\n            this.event(Game.Event_KeyNum, this.keyNum);\r\n            this.keyNum = -1;\r\n        }\r\n    }\r\n    get normalizedTime() {\r\n        return this.ani_.getCurrentAnimatorPlayState().normalizedTime;\r\n    }\r\n    rotation(n) {\r\n        if (!n) {\r\n            return;\r\n        }\r\n        if (this.gamedata.hp <= 0) {\r\n            return;\r\n        }\r\n        this.facen3d_ = n;\r\n        this.facen2d_ = (2 * Math.PI - n);\r\n        var nn = Math.atan2(Math.sin(n) / Game.cameraCN.cos0, Math.cos(n));\r\n        nn = ((nn + Math.PI / 2) / Math.PI * 180);\r\n        var ey = Math.round(nn);\r\n        if (ey >= 360) {\r\n            while (ey >= 360) {\r\n                ey -= 360;\r\n            }\r\n        }\r\n        else if (ey < 0) {\r\n            while (ey < 0) {\r\n                ey += 360;\r\n            }\r\n        }\r\n        if (this.gamedata_.rspeed <= 0) {\r\n            this.sp3d_.transform.localRotationEulerY = ey;\r\n            this.rotationEulerY = this.sp3d_.transform.localRotationEulerY;\r\n            return;\r\n        }\r\n        if (this.rotationEulerY != ey) {\r\n            this.rotationEulerY = ey;\r\n            if (this.sp3d_.transform.localRotationEulerY >= 360) {\r\n                while (this.sp3d_.transform.localRotationEulerY >= 360) {\r\n                    this.sp3d_.transform.localRotationEulerY -= 360;\r\n                }\r\n            }\r\n            else if (this.sp3d_.transform.localRotationEulerY < 0) {\r\n                while (this.sp3d_.transform.localRotationEulerY < 0) {\r\n                    this.sp3d_.transform.localRotationEulerY += 360;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    ai() {\r\n        this.ac1();\r\n        if (this.animator && this.animator.speed > 0 && this.gamedata_.proType == GameProType.Hero) {\r\n            if (this.acstr_ == GameAI.Run) {\r\n                if (this.animator.speed == 1) {\r\n                    this.animator.speed = (this.speed_ / 6);\r\n                }\r\n            }\r\n            if (this.acstr_ == GameAI.NormalAttack || this.acstr_ == GameAI.closeCombat) {\r\n                this.animator.speed = 2;\r\n            }\r\n            else {\r\n                if (this.animator.speed != 1) {\r\n                    this.animator.speed = 1;\r\n                }\r\n            }\r\n        }\r\n        if (this.gameAI) {\r\n            this.gameAI.exeAI(this);\r\n        }\r\n        if (this.isDie) {\r\n            return;\r\n        }\r\n        if (this.sp3d_ == null) {\r\n            return;\r\n        }\r\n        if (this.sp3d_ && this.rotationEulerY == this.sp3d_.transform.localRotationEulerY) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this.gamedata_.rspeed; i++) {\r\n            var n = this.rotationEulerY - this.sp3d_.transform.localRotationEulerY;\r\n            if (n == 0) {\r\n                break;\r\n            }\r\n            else if ((n > 0 && n <= 180) || (n < -180)) {\r\n                this.sp3d_.transform.localRotationEulerY += 1;\r\n            }\r\n            else {\r\n                this.sp3d_.transform.localRotationEulerY -= 1;\r\n            }\r\n            while (this.sp3d_.transform.localRotationEulerY >= 360) {\r\n                this.sp3d_.transform.localRotationEulerY -= 360;\r\n            }\r\n            while (this.sp3d_.transform.localRotationEulerY < 0) {\r\n                this.sp3d_.transform.localRotationEulerY += 360;\r\n            }\r\n        }\r\n    }\r\n    get pos2() {\r\n        return this._pos2;\r\n    }\r\n    pos2To3d() {\r\n        this.sp3d_.transform.localPositionX = this._pos2.x / GameBG.ww;\r\n        this.sp3d_.transform.localPositionZ = this._pos2.z / Game.cameraCN.cos0 / GameBG.ww;\r\n        this.hbox_.setXY(GameBG.mcx + this._pos2.x, GameBG.mcy + this._pos2.z);\r\n        if (this.sp2d_) {\r\n            this.sp2d_.x = this.hbox_.x;\r\n            this.sp2d_.y = this.hbox_.y;\r\n            Game.footLayer.addChild(this.sp2d_);\r\n        }\r\n        this.updateUI();\r\n    }\r\n    updateUI() {\r\n        this._bloodUI && this._bloodUI.pos(this.hbox_.cx, this.hbox_.cy - 90);\r\n        this._footCircle && this._footCircle.pos(this.hbox_.cx, this.hbox_.cy);\r\n        this._bulletShadow && this._bulletShadow.pos(this.hbox_.cx, this.hbox_.cy);\r\n    }\r\n    get z() {\r\n        return this.sp3d_.transform.localPositionZ;\r\n    }\r\n    get x() {\r\n        return this.sp3d_.transform.localPositionX;\r\n    }\r\n    move2D(n, hd = true) {\r\n        if (this.isIce) {\r\n            return;\r\n        }\r\n        this.moven2d_ = n;\r\n        if (this.movef) {\r\n            return this.movef.move2d(n, this, this.speed, false);\r\n        }\r\n        return false;\r\n    }\r\n    setXY2D(xx, yy) {\r\n        this.pos2.x = xx;\r\n        this.pos2.z = yy;\r\n        this.pos2To3d();\r\n    }\r\n    setcXcY2DBox(xx, yy) {\r\n        this.hbox_.setCenter(xx, yy);\r\n        this.pos2.x = this.hbox_.x - GameBG.mcx;\r\n        this.pos2.z = this.hbox_.y - GameBG.mcy;\r\n        this.pos2To3d();\r\n    }\r\n    setXY2DBox(xx, yy) {\r\n        this.hbox_.setXY(xx, yy);\r\n        this.pos2.x = this.hbox_.x - GameBG.mcx;\r\n        this.pos2.z = this.hbox_.y - GameBG.mcy;\r\n        this.pos2To3d();\r\n    }\r\n    startAi() {\r\n        if (this.gameAI) {\r\n            this.gameAI.starAi();\r\n            if (Game.AiArr.indexOf(this) < 0) {\r\n                Game.AiArr.push(this);\r\n            }\r\n        }\r\n    }\r\n    stopAi() {\r\n        if (this.gameAI) {\r\n            this.gameAI.stopAi();\r\n        }\r\n        var index = Game.AiArr.indexOf(this);\r\n        if (index > -1) {\r\n            Game.AiArr.splice(index, 1);\r\n        }\r\n        else {\r\n            console.error(\"为什么没有这个\");\r\n        }\r\n    }\r\n    get gamedata() {\r\n        return this.gamedata_;\r\n    }\r\n}\r\n",
  "references": [
    "D:/gitworker/Game3DUP/src/game/GameHitBox.ts",
    "D:/gitworker/Game3DUP/src/game/GameBG.ts",
    "D:/gitworker/Game3DUP/src/game/Game.ts",
    "D:/gitworker/Game3DUP/src/game/GameData.ts",
    "D:/gitworker/Game3DUP/src/game/HeroBlood.ts",
    "D:/gitworker/Game3DUP/src/game/FootCircle.ts",
    "D:/gitworker/Game3DUP/src/game/GameProType.ts",
    "D:/gitworker/Game3DUP/src/game/Blood.ts",
    "D:/gitworker/Game3DUP/src/main/sys/SysEnemy.ts",
    "D:/gitworker/Game3DUP/src/main/sys/SysBullet.ts",
    "D:/gitworker/Game3DUP/src/game/ai/GameAI.ts",
    "D:/gitworker/Game3DUP/src/game/move/GameMove.ts",
    "D:/gitworker/Game3DUP/src/ui/layaMaxUI.ts",
    "D:/gitworker/Game3DUP/src/game/effect/BloodEffect.ts"
  ]
}
