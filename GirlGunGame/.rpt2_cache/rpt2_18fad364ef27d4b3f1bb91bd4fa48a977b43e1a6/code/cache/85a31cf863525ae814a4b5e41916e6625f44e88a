{
  "code": "import App from \"../../core/App\";\r\nimport SysTalentInfo from \"../../main/sys/SysTalentInfo\";\r\nimport GameEvent from \"../../main/GameEvent\";\r\nimport Session from \"../../main/Session\";\r\nimport { GoldType } from \"./HomeData\";\r\nimport SysTalentCost from \"../../main/sys/SysTalentCost\";\r\nimport Equip from \"./Equip\";\r\nimport SysTalent from \"../../main/sys/SysTalent\";\r\nexport default class TalentData {\r\n    constructor() {\r\n        this.talentArr = [];\r\n        this.lvTimes = 0;\r\n        this.imgArr = [];\r\n        this.talentLvMap = {};\r\n        this.atk = 0;\r\n        this.hp = 0;\r\n        this.def = 0;\r\n        this.equip = new Equip();\r\n        this.offlineGold = 0;\r\n        this.lineGold = 0;\r\n        this.addCompose = 0;\r\n        this.dropLevelhp = 0;\r\n        this.addItemhp = 0;\r\n        this.addData(\"tianfu/PTkuang.png\", \"tianfu/gongji.png\", \"tianfu/gongzi.png\", 1);\r\n        this.addData(\"tianfu/PTkuang.png\", \"tianfu/baoji.png\", \"tianfu/baozi.png\", 2);\r\n        this.addData(\"tianfu/PTkuang.png\", \"tianfu/xingyun.png\", \"tianfu/xingzi.png\", 3);\r\n        this.addData(\"tianfu/JYkuang.png\", \"tianfu/fangyu.png\", \"tianfu/fangzi.png\", 4);\r\n        this.addData(\"tianfu/JYkuang.png\", \"tianfu/sudu.png\", \"tianfu/yizi.png\", 5);\r\n        this.addData(\"tianfu/JYkuang.png\", \"tianfu/shengming.png\", \"tianfu/shengzi.png\", 6);\r\n        this.addData(\"tianfu/SSkuang.png\", \"tianfu/tiejiang.png\", \"tianfu/tiezi.png\", 7);\r\n        this.addData(\"tianfu/SSkuang.png\", \"tianfu/jinbi.png\", \"tianfu/diaozi.png\", 8);\r\n        this.addData(\"tianfu/SSkuang.png\", \"tianfu/lixian.png\", \"tianfu/lizi.png\", 9);\r\n    }\r\n    addData(bg, logo, font, id) {\r\n        this.imgArr.push({ bg: bg, logo: logo, font: font, id: id });\r\n    }\r\n    getImgData(id) {\r\n        return this.imgArr[id - 1];\r\n    }\r\n    setData(data) {\r\n        if (data.talent == null) {\r\n            this.initData(data);\r\n        }\r\n        let arr = data.talent.split(\",\");\r\n        for (let i = 0; i < arr.length; i += 2) {\r\n            let tId = parseInt(arr[i]);\r\n            let tLv = parseInt(arr[i + 1]);\r\n            this.talentLvMap[tId] = tLv;\r\n        }\r\n        this.lvTimes = (data.lvTimes ? data.lvTimes : 0);\r\n        this.updateAttribute();\r\n    }\r\n    saveData(data) {\r\n        let arr = [];\r\n        for (let k in this.talentLvMap) {\r\n            arr.push(k);\r\n            arr.push(this.talentLvMap[k]);\r\n        }\r\n        data.talent = arr.join(\",\");\r\n        data.lvTimes = this.lvTimes;\r\n    }\r\n    initData(data) {\r\n        let sysArr = App.tableManager.getTable(SysTalentInfo.NAME);\r\n        for (let k of sysArr) {\r\n            this.talentLvMap[k.id] = 0;\r\n        }\r\n    }\r\n    getLv(id) {\r\n        return this.talentLvMap[id];\r\n    }\r\n    getTxt(index) {\r\n        return \"\";\r\n    }\r\n    updateAttribute() {\r\n        this.equip.reset0();\r\n        this.equip.atk = this.getAtt(1);\r\n        this.equip.hp = this.getAtt(2);\r\n        this.equip.def = this.getAtt(4);\r\n        this.equip.atkSpeed = this.getAtt(5);\r\n        this.addItemhp = this.getAtt(3);\r\n        this.dropLevelhp = this.getAtt(6);\r\n        this.addCompose = this.getAtt(7);\r\n        this.lineGold = this.getAtt(8);\r\n        this.offlineGold = this.getAtt(9);\r\n    }\r\n    getAtt(tid) {\r\n        let lv = this.getLv(tid);\r\n        if (lv == 0) {\r\n            return 0;\r\n        }\r\n        let sysInfo = App.tableManager.getDataByNameAndId(SysTalentInfo.NAME, tid);\r\n        let sysT = App.tableManager.getDataByNameAndId(SysTalent.NAME, lv);\r\n        let v = sysT[sysInfo.idName];\r\n        if (sysInfo.talentType == 1) {\r\n            return v;\r\n        }\r\n        else if (sysInfo.talentType == 2) {\r\n            return v / 100;\r\n        }\r\n        return v;\r\n    }\r\n    lvUp(id) {\r\n        let res = this.canLvUp();\r\n        if (res != 0) {\r\n            return res;\r\n        }\r\n        this.lvTimes++;\r\n        let sys = App.tableManager.getDataByNameAndId(SysTalentCost.NAME, (this.lvTimes + 1));\r\n        Session.homeData.changeGold(GoldType.GOLD, -sys.talentCost);\r\n        this.talentLvMap[id] = this.getLv(id) + 1;\r\n        App.sendEvent(GameEvent.TALENT_UPDATE);\r\n        Session.saveData();\r\n        this.updateAttribute();\r\n        return res;\r\n    }\r\n    getGold() {\r\n        let sys = App.tableManager.getDataByNameAndId(SysTalentCost.NAME, (this.lvTimes + 1));\r\n        return sys.talentCost;\r\n    }\r\n    haveGold() {\r\n        let g = Session.homeData.getGoldByType(GoldType.GOLD);\r\n        let sys = App.tableManager.getDataByNameAndId(SysTalentCost.NAME, (this.lvTimes + 1));\r\n        return g >= sys.talentCost;\r\n    }\r\n    canLvUp() {\r\n        if (this.haveGold() == false) {\r\n            return -1;\r\n        }\r\n        if (this.lvTimes >= Session.homeData.playerLv) {\r\n            return -2;\r\n        }\r\n        return 0;\r\n    }\r\n    canLvUp2() {\r\n        return this.canLvUp() == 0;\r\n    }\r\n}\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/game/data/IData.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/App.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysTalentInfo.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HomeData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysTalentCost.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/Equip.ts",
    "D:/GirlGunGame/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysTalent.ts"
  ]
}
