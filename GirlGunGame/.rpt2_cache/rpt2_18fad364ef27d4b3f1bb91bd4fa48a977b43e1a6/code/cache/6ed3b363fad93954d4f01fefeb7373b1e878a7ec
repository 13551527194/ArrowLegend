{
  "code": "import GameEvent from \"../../main/GameEvent\";\r\nexport default class GameSoundManager {\r\n    constructor() {\r\n        this.bgmMap = {};\r\n        this.currentWxSound = null;\r\n        this.bgmUrl = null;\r\n        this.noBgm = false;\r\n        this.noEff = false;\r\n        Laya.timer.callLater(this, this.initEvent);\r\n    }\r\n    onWX_ON_SHOW() {\r\n        if (Laya.Browser.onMiniGame && this.currentWxSound) {\r\n            this.currentWxSound.play();\r\n        }\r\n    }\r\n    onWX_ON_HIDE() {\r\n        if (Laya.Browser.onMiniGame && this.currentWxSound) {\r\n            this.currentWxSound.pause();\r\n        }\r\n    }\r\n    initEvent() {\r\n        Laya.stage.once(GameEvent.WX_ON_SHOW, this, this.onWX_ON_SHOW);\r\n        Laya.stage.once(GameEvent.WX_ON_HIDE, this, this.onWX_ON_HIDE);\r\n        Laya.stage.once(GameEvent.AD_OVER, this, this.onWX_ON_SHOW);\r\n    }\r\n    openSceneFun(url) {\r\n        if (this.bgmMap[url]) {\r\n            this.playBgm(this.bgmMap[url]);\r\n        }\r\n    }\r\n    reg(url, bgm) {\r\n        this.bgmMap[url] = bgm;\r\n        if (url == GameSoundManager.BTN) {\r\n            Laya.stage.on(Laya.Event.CLICK, this, this.clickFun);\r\n        }\r\n    }\r\n    clickFun(e) {\r\n        if (e.target instanceof Laya.Button) {\r\n            this.playEffect(this.bgmMap[GameSoundManager.BTN]);\r\n        }\r\n    }\r\n    playBgm(url) {\r\n        this.bgmUrl = url;\r\n        if (Laya.Browser.onMiniGame) {\r\n            if (this.currentWxSound) {\r\n                this.currentWxSound.stop();\r\n                this.currentWxSound.destroy();\r\n                this.currentWxSound = null;\r\n            }\r\n            let wxSound = Laya.Browser.window.wx.createInnerAudioContext();\r\n            wxSound.autoplay = true;\r\n            wxSound.loop = true;\r\n            wxSound.src = Laya.URL.basePath + url;\r\n            this.currentWxSound = wxSound;\r\n            this.setBgmMuted(this.noBgm);\r\n        }\r\n        else {\r\n            Laya.SoundManager.playMusic(url);\r\n        }\r\n    }\r\n    setBgmMuted(v) {\r\n        this.noBgm = v;\r\n        if (Laya.Browser.onMiniGame && this.currentWxSound) {\r\n            if (v) {\r\n                this.currentWxSound.volume = 0;\r\n            }\r\n            else {\r\n                this.currentWxSound.volume = 0.5;\r\n            }\r\n        }\r\n        else {\r\n            Laya.SoundManager.musicMuted = v;\r\n        }\r\n    }\r\n    setEffMuted(v) {\r\n        this.noEff = v;\r\n    }\r\n    stopBgm() {\r\n        if (Laya.Browser.onMiniGame) {\r\n            if (this.currentWxSound) {\r\n                this.currentWxSound.stop();\r\n                this.currentWxSound.destroy();\r\n                this.currentWxSound = null;\r\n                console.log(\"音频已经销毁\");\r\n            }\r\n        }\r\n        else {\r\n            Laya.SoundManager.stopMusic();\r\n        }\r\n    }\r\n    playEffect(url) {\r\n        if (this.noEff) {\r\n            return;\r\n        }\r\n        if (Laya.Browser.onMiniGame) {\r\n            let b = Laya.Pool.getItem(url);\r\n            if (b == null) {\r\n                new WXSound(url);\r\n            }\r\n            else {\r\n                b.play();\r\n            }\r\n        }\r\n        else {\r\n            Laya.SoundManager.playSound(url);\r\n        }\r\n    }\r\n}\r\nGameSoundManager.BTN = \"BTN\";\r\nexport class WXSound {\r\n    constructor(url) {\r\n        this.url = url;\r\n        this.wxSound = Laya.Browser.window.wx.createInnerAudioContext();\r\n        this.wxSound.autoplay = true;\r\n        this.wxSound.loop = false;\r\n        this.wxSound.src = Laya.URL.basePath + url;\r\n        this.wxSound.onEnded(() => {\r\n            Laya.Pool.recover(this.url, this.wxSound);\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts"
  ]
}
