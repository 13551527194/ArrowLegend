{
  "code": "import { ui } from \"../../../../ui/layaMaxUI\";\r\nimport Session from \"../../../Session\";\r\nimport SysRoleUp from \"../../../sys/SysRoleUp\";\r\nimport { HeroLvType } from \"../../../../game/data/HeroData\";\r\nimport SysRoleBase from \"../../../sys/SysRolebase\";\r\nimport App from \"../../../../core/App\";\r\nimport AdDiamond from \"../../../dialog/AdDiamond\";\r\nimport AutoEvent from \"../../../../core/utils/AutoEvent\";\r\nimport GameEvent from \"../../../GameEvent\";\r\nimport SysSkill from \"../../../sys/SysSkill\";\r\nimport { GoldType } from \"../../../../game/data/HomeData\";\r\nimport FlyUpTips from \"../../../FlyUpTips\";\r\nimport FlyEffect from \"../../../../game/effect/FlyEffect\";\r\nimport RollCell from \"./RollCell\";\r\nimport GuideManager, { Guide_Type } from \"../../../guide/GuideManager\";\r\nimport Game from \"../../../../game/Game\";\r\nimport GameMain from \"../../../GameMain\";\r\nimport NoResDialog, { NoResDialogType } from \"../../../dialog/NoResDialog\";\r\nimport Hero from \"../../../../game/player/Hero\";\r\nexport default class RoleView extends ui.test.jueseUI {\r\n    constructor() {\r\n        super();\r\n        this.nowRoleId = 1;\r\n        this.autoEvent = new AutoEvent();\r\n        this.heroLvTypeMap = {};\r\n        this.oldNum = 0;\r\n        this._gameScene = new Laya.Scene3D();\r\n        this.roleBox.addChild(this._gameScene);\r\n        this._layer3d = new Laya.Sprite3D();\r\n        this._gameScene.addChild(this._layer3d);\r\n        let camera = new Laya.Camera(0, 0.1, 100);\r\n        this._gameScene.addChild(camera);\r\n        camera.transform.translate(new Laya.Vector3(0, 0.5, 1));\r\n        camera.transform.rotate(new Laya.Vector3(-15, 0, 0), true, false);\r\n        camera.clearFlag = Laya.BaseCamera.CLEARFLAG_DEPTHONLY;\r\n        let directionLight = new Laya.DirectionLight();\r\n        this._gameScene.addChild(directionLight);\r\n        directionLight.color = new Laya.Vector3(1, 1, 1);\r\n        directionLight.transform.rotate(new Laya.Vector3(-3.14 / 3, 0, 0));\r\n        this.autoEvent.setSprite(this);\r\n        this.shengmingniu.clickHandler = new Laya.Handler(this, this.hpFun, [this.shengmingniu]);\r\n        this.gongjiniu.clickHandler = new Laya.Handler(this, this.atkFun, [this.gongjiniu]);\r\n        this.on(Laya.Event.DISPLAY, this, this.disFun);\r\n        this.jia.clickHandler = new Laya.Handler(this, this.jiaFun, [GoldType.RED_DIAMONG, this.redImg, this.xueshu, HeroLvType.HP]);\r\n        this.jia2.clickHandler = new Laya.Handler(this, this.jiaFun, [GoldType.BLUE_DIAMONG, this.blueImg, this.gongshu, HeroLvType.ATK]);\r\n        this.autoEvent.onEvent(GameEvent.GOLD_CHANGE, this, this.goldChangeFun);\r\n        this.autoEvent.onEvent(GameEvent.HERO_UPDATE, this, this.heroFun);\r\n        Laya.stage.on(GameEvent.HERO_UPDATE, this, this.heroLvUpFun);\r\n        this.lvEff.visible = false;\r\n        this.a1.ani1.interval = this.a2.ani1.interval = 1000 / 60;\r\n        this.a1.ani1.stop();\r\n        this.a2.ani1.stop();\r\n        this.a1.visible = this.a2.visible = false;\r\n        Laya.timer.loop(4000, this, this.ani1tFun);\r\n        let r = new RollCell();\r\n        r.heroLvType = HeroLvType.HP;\r\n        r.goldType = GoldType.RED_DIAMONG;\r\n        r.vs1 = this.vs1;\r\n        r.vs2 = this.vs11;\r\n        r.goldImg = this.redImg;\r\n        r.goldFc = this.xueshu;\r\n        r.lvUpBtnGoldText = this.hpGold;\r\n        r.progressBarImg = this.tiao;\r\n        r.lvFc = this.hpLv;\r\n        r.goldAddBtn = this.jia;\r\n        r.goldBox = this.box1;\r\n        r.nowLvAddfc = this.shengmingjia;\r\n        r.heroBaseFc = this.shengmingshu;\r\n        r.heroAddFc = this.hpAddFc;\r\n        r.lvUpBtn = this.shengmingniu;\r\n        r.lv = this.lv1;\r\n        let r1 = new RollCell();\r\n        r1.heroLvType = HeroLvType.ATK;\r\n        r1.goldType = GoldType.BLUE_DIAMONG;\r\n        r1.vs1 = this.vs2;\r\n        r1.vs2 = this.vs12;\r\n        r1.goldImg = this.blueImg;\r\n        r1.goldFc = this.gongshu;\r\n        r1.lvUpBtnGoldText = this.atkGold;\r\n        r1.progressBarImg = this.tiao2;\r\n        r1.lvFc = this.atkLv;\r\n        r1.goldAddBtn = this.jia2;\r\n        r1.goldBox = this.box2;\r\n        r1.nowLvAddfc = this.gongjijia;\r\n        r1.heroBaseFc = this.gongjishu;\r\n        r1.heroAddFc = this.atkAddFc;\r\n        r1.lvUpBtn = this.gongjiniu;\r\n        r1.lv = this.lv2;\r\n        this.heroLvTypeMap[r.heroLvType] = r;\r\n        this.heroLvTypeMap[r1.heroLvType] = r1;\r\n        this.zuo.clickHandler = new Laya.Handler(this, this.turnFun, [-1]);\r\n        this.you.clickHandler = new Laya.Handler(this, this.turnFun, [1]);\r\n        this.updateAll();\r\n        Laya.stage.on(GameEvent.AD_OVER, this, this.adOverFun);\r\n    }\r\n    adOverFun() {\r\n        Laya.timer.callLater(this, this.clFun);\r\n    }\r\n    clFun() {\r\n        this.setNowRoleId(this.nowRoleId);\r\n    }\r\n    turnFun(v) {\r\n        let now = this.nowRoleId;\r\n        if (v <= 0) {\r\n            now = Math.max(now + v, 1);\r\n        }\r\n        else {\r\n            now = Math.min(now + v, 3);\r\n        }\r\n        this.setNowRoleId(now);\r\n    }\r\n    setNowRoleId(now) {\r\n        this.nowRoleId = now;\r\n        this.showRoleById(now);\r\n        this.zuo.visible = !(now == 1);\r\n        this.you.visible = !(now == 3);\r\n        this.updateAll();\r\n        this.fuhuo.mouseEnabled = false;\r\n        if (now == 3) {\r\n            this.vs109.visible = false;\r\n        }\r\n        else {\r\n            if (Session.heroData.nowRoleId == now) {\r\n                this.vs109.visible = true;\r\n                this.vs109.selectedIndex = 0;\r\n            }\r\n            else {\r\n                this.vs109.visible = true;\r\n                let sys = SysRoleBase.getSys(now);\r\n                if (Session.homeData.adTimes >= sys.videoLock) {\r\n                    this.vs109.selectedIndex = 2;\r\n                    this.fuhuo.mouseEnabled = true;\r\n                    this.fuhuo.clickHandler = new Laya.Handler(this, this.seleHeroFun, [now]);\r\n                }\r\n                else {\r\n                    this.vs109.selectedIndex = 1;\r\n                    this.hongzuan.value = Session.homeData.adTimes + \"/\" + sys.videoLock;\r\n                    let per = Session.homeData.adTimes / sys.videoLock;\r\n                    this.zitiao.scrollRect = new Laya.Rectangle(0, 0, this.zitiao.width * per, this.zitiao.height);\r\n                    if (per == 0) {\r\n                        this.zitiao.visible = false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    seleHeroFun(now) {\r\n        Session.heroData.nowRoleId = now;\r\n        this.setNowRoleId(now);\r\n        this.xuan.ani1.interval = 1000 / 45;\r\n        this.xuan.ani1.play(0, false);\r\n    }\r\n    showRoleById(roleId) {\r\n        this._layer3d.removeChildren();\r\n        if (roleId == 3) {\r\n            this.qidai.visible = true;\r\n            return;\r\n        }\r\n        this.qidai.visible = false;\r\n        Laya.Sprite3D.load(\"h5/heroview/\" + roleId + \"/hero.lh\", new Laya.Handler(this, (sp3d) => {\r\n            sp3d.transform.localRotationEulerY = 0;\r\n            var scale = 0.85;\r\n            var xx = 0;\r\n            if (roleId == 2) {\r\n                xx = 0.05;\r\n                sp3d.transform.localRotationEulerY = 15;\r\n            }\r\n            sp3d.transform.localScale = new Laya.Vector3(scale, scale, scale);\r\n            sp3d.transform.localPositionZ = -3;\r\n            sp3d.transform.localPositionY = -0.4;\r\n            sp3d.transform.localPositionX = xx;\r\n            let aniSprite3d = sp3d.getChildAt(0);\r\n            this._layer3d.addChild(sp3d);\r\n            if (aniSprite3d) {\r\n                let ani_ = aniSprite3d.getComponent(Laya.Animator);\r\n                ani_.speed = 0.5;\r\n                ani_.play(\"Idle\");\r\n            }\r\n            Hero.udpateHeroData();\r\n        }));\r\n    }\r\n    showLayer(isLeft) {\r\n        this._layer3d.transform.localPositionX = isLeft ? 2 : -2;\r\n        Laya.Tween.to(this._layer3d.transform, { localPositionX: 0 }, 300);\r\n    }\r\n    hideLayer(isLeft) {\r\n        this._layer3d.transform.localPositionX = 0;\r\n        Laya.Tween.to(this._layer3d.transform, { localPositionX: isLeft ? -2 : 2 }, 300);\r\n    }\r\n    ani1tFun() {\r\n        this.a1.visible = true;\r\n        this.a1.ani1.play(0, false);\r\n        Laya.timer.once(1000, this, this.ani2tFun);\r\n    }\r\n    ani2tFun() {\r\n        this.a2.visible = true;\r\n        this.a2.ani1.play(0, false);\r\n    }\r\n    heroLvUpFun() {\r\n        this.lvEff.visible = true;\r\n        this.lvEff.sk1.play(0, false, false, 0);\r\n        Laya.timer.frameLoop(1, this, this.floopFun, [this.lvEff.sk1]);\r\n    }\r\n    floopFun(sk) {\r\n        if (sk.index == sk.total) {\r\n            sk.stop();\r\n            this.lvEff.visible = false;\r\n            Laya.timer.clear(this, this.floopFun);\r\n        }\r\n    }\r\n    efFun() {\r\n        this.lvEff.visible = false;\r\n    }\r\n    heroFun() {\r\n        this.updateAll();\r\n    }\r\n    goldChangeFun() {\r\n    }\r\n    jiaFun(goldType, flyTarget, fc, type) {\r\n        let dia = new NoResDialog();\r\n        dia.heroType = type;\r\n        if (goldType == GoldType.RED_DIAMONG) {\r\n            dia.setType(NoResDialogType.red);\r\n        }\r\n        else {\r\n            dia.setType(NoResDialogType.blue);\r\n        }\r\n        dia.popup();\r\n        this.oldNum = Session.homeData.getGoldByType(goldType);\r\n        dia.on(AdDiamond.CHANGE_GOLD_EVENT, this, this.flyGoldFun, [flyTarget, fc, type]);\r\n    }\r\n    flyGoldFun(flyTarget, fc, type, y, v) {\r\n        let fly = new FlyEffect();\r\n        fly.flyNum = v;\r\n        fly.flySkin = flyTarget.skin;\r\n        fly.endOffX = flyTarget.width / 2;\r\n        fly.endOffY = flyTarget.height / 2;\r\n        fly.flyTargetHandler = new Laya.Handler(this, this.flyFun, [type]);\r\n        fly.flyFromP(Laya.stage.width / 2, Laya.stage.height / 2, flyTarget, v, this.oldNum, fc);\r\n    }\r\n    flyFun(type, fc, now) {\r\n        let lv = Session.heroData.getHeroLv(this.nowRoleId, type);\r\n        let sysRB = SysRoleBase.getSys(this.nowRoleId);\r\n        let sys = SysRoleUp.getSysRole(this.nowRoleId, lv);\r\n        let cost = sys.getCost(type);\r\n        let rc = this.heroLvTypeMap[type];\r\n        rc.setValue(now, cost);\r\n        if (now == cost) {\r\n            Laya.timer.once(800, this, this.tttFun, [rc]);\r\n        }\r\n    }\r\n    tttFun(rc) {\r\n        rc.effect1();\r\n    }\r\n    disFun() {\r\n        this.updateAll();\r\n        this.setNowRoleId(Session.heroData.nowRoleId);\r\n        if (Session.homeData.newStat == Guide_Type.click_hp) {\r\n            GuideManager.getInstance().hand(this.shengmingniu, this.shengmingniu.width / 2, this.shengmingniu.height / 2, Guide_Type.over, 600, true);\r\n        }\r\n    }\r\n    hpFun(btn) {\r\n        if (btn.visible == false) {\r\n            return;\r\n        }\r\n        let res = Session.heroData.lvUp(this.nowRoleId, HeroLvType.HP);\r\n        this.tip(res);\r\n    }\r\n    atkFun(btn) {\r\n        if (btn.visible == false) {\r\n            return;\r\n        }\r\n        let res = Session.heroData.lvUp(this.nowRoleId, HeroLvType.ATK);\r\n        this.tip(res);\r\n    }\r\n    tip(res) {\r\n        if (res == 2) {\r\n            FlyUpTips.setTips(\"钻石不够\");\r\n        }\r\n        else if (res == 3) {\r\n            FlyUpTips.setTips(\"升级到头了\");\r\n        }\r\n        else if (res == 4) {\r\n            FlyUpTips.setTips(\"金币不够\");\r\n            App.dialogManager.open(GameMain.TIME_GOLD);\r\n        }\r\n        else if (res == 5) {\r\n            FlyUpTips.setTips(\"升级到头了\");\r\n        }\r\n        else if (res == 0) {\r\n            Game.playSound(\"fx_slot_lucky.wav\");\r\n        }\r\n    }\r\n    updateAll() {\r\n        for (let k in this.heroLvTypeMap) {\r\n            let cell = this.heroLvTypeMap[k];\r\n            cell.setData(this.nowRoleId);\r\n        }\r\n        this.setSkill(this.nowRoleId);\r\n    }\r\n    setSkill(roleId) {\r\n        if (SysRoleBase.have(roleId) == false) {\r\n            this.skillLabel.text = \"\";\r\n            this.jinengming.text = \"\";\r\n            this.jinengtubiao.skin = \"main/kawen.png\";\r\n            return;\r\n        }\r\n        let sys = SysRoleBase.getSys(roleId);\r\n        let sysSkill = App.tableManager.getDataByNameAndId(SysSkill.NAME, sys.baseSkill);\r\n        this.skillLabel.text = sysSkill.skillInfo;\r\n        this.jinengming.text = sysSkill.skillName;\r\n        this.jinengtubiao.skin = null;\r\n        this.jinengtubiao.skin = \"icons/skill/\" + sysSkill.id + \".png\";\r\n    }\r\n}\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysRoleUp.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HeroData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysRolebase.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/App.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/dialog/AdDiamond.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/utils/AutoEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysSkill.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HomeData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/FlyUpTips.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/main/world/WorldCell.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/effect/FlyEffect.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/main/role/RollCell.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/guide/GuideManager.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/Game.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameMain.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/dialog/NoResDialog.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/player/Hero.ts"
  ]
}
