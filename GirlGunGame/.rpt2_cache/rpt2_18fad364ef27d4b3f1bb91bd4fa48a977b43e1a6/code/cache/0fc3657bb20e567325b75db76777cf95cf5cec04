{
  "code": "import App from \"../../core/App\";\r\nimport SysRoleBase from \"../../main/sys/SysRolebase\";\r\nimport SysRoleUp from \"../../main/sys/SysRoleUp\";\r\nimport Session from \"../../main/Session\";\r\nimport { GoldType } from \"./HomeData\";\r\nimport GameEvent from \"../../main/GameEvent\";\r\nimport { GOLD_CHANGE_TYPE } from \"../../UseGoldType\";\r\nimport HeroBaseData from \"./HeroBaseData\";\r\nimport Equip from \"./Equip\";\r\nexport default class HeroData {\r\n    constructor() {\r\n        this.heroMap = {};\r\n        this.nowRoleId = 1;\r\n    }\r\n    setData(data) {\r\n        this.initData(null);\r\n        let str = data.heroData;\r\n        let arr = str.split(\".\");\r\n        for (let v of arr) {\r\n            let hd = new HeroBaseData();\r\n            hd.setString(v);\r\n            this.heroMap[hd.id] = hd;\r\n        }\r\n        this.nowRoleId = (data.nowRoleId ? data.nowRoleId : 1);\r\n    }\r\n    saveData(data) {\r\n        let arr = [];\r\n        for (let k in this.heroMap) {\r\n            let hd = this.heroMap[k];\r\n            arr.push(hd.getString());\r\n        }\r\n        data.heroData = arr.join(\".\");\r\n        data.nowRoleId = this.nowRoleId;\r\n    }\r\n    initData(data) {\r\n        let arr = App.tableManager.getTable(SysRoleBase.NAME);\r\n        for (let k of arr) {\r\n            let hd = new HeroBaseData();\r\n            hd.id = k.id;\r\n            hd.initData();\r\n            this.heroMap[hd.id] = hd;\r\n        }\r\n        this.nowRoleId = 1;\r\n    }\r\n    getHeroLv(heroId, type) {\r\n        let hd = this.heroMap[heroId];\r\n        return hd.getLv(type);\r\n    }\r\n    getHeroBaseData(heroId) {\r\n        return this.heroMap[heroId];\r\n    }\r\n    getBaseTime(type, heroId) {\r\n        let b = this.getHeroBaseData(heroId);\r\n        if (type == HeroLvType.ATK) {\r\n            return b.atkTime;\r\n        }\r\n        return b.hpTime;\r\n    }\r\n    getHeroData(heroId) {\r\n        let e = new Equip();\r\n        let sysRB = SysRoleBase.getSys(heroId);\r\n        e.atk = sysRB.baseAtk + this.getValue(heroId, HeroLvType.ATK) * (1 + Session.talentData.addCompose) + Session.talentData.equip.atk;\r\n        e.hp = sysRB.baseHp + this.getValue(heroId, HeroLvType.HP) * (1 + Session.talentData.addCompose) + Session.talentData.equip.hp;\r\n        e.atk = parseInt(e.atk + \"\");\r\n        e.hp = parseInt(e.hp + \"\");\r\n        console.log(sysRB.baseAtk, this.getValue(heroId, HeroLvType.ATK), Session.talentData.addCompose, Session.talentData.equip.atk);\r\n        console.log(sysRB.baseHp, this.getValue(heroId, HeroLvType.HP), Session.talentData.addCompose, Session.talentData.equip.hp);\r\n        e.dodge = sysRB.baseDodge;\r\n        e.moveSpeed = sysRB.baseMove;\r\n        e.atkSpeed = sysRB.baseSpeed;\r\n        e.crit = sysRB.baseCrit;\r\n        e.critEffect = sysRB.baseCritHurt;\r\n        e.initSkillId = sysRB.baseSkill;\r\n        return e;\r\n    }\r\n    getValue(heroId, type) {\r\n        let lv = this.getHeroLv(heroId, type);\r\n        return SysRoleUp.getAddValue(heroId, lv, type);\r\n    }\r\n    lvUp(heroId, type) {\r\n        let hd = this.heroMap[heroId];\r\n        let lv = hd.getLv(type);\r\n        let sys = SysRoleUp.getSysRole(heroId, lv);\r\n        let cost = sys.getCost(type);\r\n        let goldType = sys.getCostType(type);\r\n        if (Session.homeData.getGoldByType(goldType) < cost) {\r\n            return 2;\r\n        }\r\n        let nowLv = lv + 1;\r\n        let nowSys = SysRoleUp.getSysRole(heroId, nowLv);\r\n        if (nowSys == null) {\r\n            return 3;\r\n        }\r\n        if (Session.homeData.getGoldByType(GoldType.GOLD) < sys.costGold) {\r\n            return 4;\r\n        }\r\n        let sysRB = App.tableManager.getDataByNameAndId(SysRoleBase.NAME, heroId);\r\n        if (nowLv > sysRB.roleLimt) {\r\n            return 5;\r\n        }\r\n        Session.homeData.changeGold(goldType, -cost, GOLD_CHANGE_TYPE.HERO_LV_ABILITY);\r\n        Session.homeData.changeGold(GoldType.GOLD, -sys.costGold, GOLD_CHANGE_TYPE.AD_DIAMOND);\r\n        hd.setLv(type, nowLv);\r\n        Laya.stage.event(GameEvent.HERO_UPDATE);\r\n        Session.saveData();\r\n        return 0;\r\n    }\r\n    canLvUp() {\r\n        let arr = App.tableManager.getTable(SysRoleBase.NAME);\r\n        for (let a of arr) {\r\n            if (this.test(a.id, HeroLvType.HP)) {\r\n                return true;\r\n            }\r\n            if (this.test(a.id, HeroLvType.ATK)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    test(heroId, type) {\r\n        let hd = this.heroMap[heroId];\r\n        let lv = hd.getLv(type);\r\n        let sys = SysRoleUp.getSysRole(heroId, lv);\r\n        let cost = sys.getCost(type);\r\n        let goldType = sys.getCostType(type);\r\n        if (Session.homeData.getGoldByType(goldType) < cost) {\r\n            return false;\r\n        }\r\n        let nowLv = lv + 1;\r\n        let nowSys = SysRoleUp.getSysRole(heroId, nowLv);\r\n        if (nowSys == null) {\r\n            return false;\r\n        }\r\n        if (Session.homeData.getGoldByType(GoldType.GOLD) < sys.costGold) {\r\n            return false;\r\n        }\r\n        let sysRB = App.tableManager.getDataByNameAndId(SysRoleBase.NAME, heroId);\r\n        if (nowLv > sysRB.roleLimt) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\nexport var HeroLvType;\r\n(function (HeroLvType) {\r\n    HeroLvType[HeroLvType[\"ATK\"] = 0] = \"ATK\";\r\n    HeroLvType[HeroLvType[\"HP\"] = 1] = \"HP\";\r\n})(HeroLvType || (HeroLvType = {}));\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/game/data/IData.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/App.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysRolebase.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysRoleUp.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HomeData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/FlyUpTips.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/UseGoldType.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HeroBaseData.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/Equip.ts"
  ]
}
