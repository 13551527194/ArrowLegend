{
  "code": "import Session from \"../../main/Session\";\r\nimport { GoldType } from \"./HomeData\";\r\nexport default class TimeGoldData {\r\n    constructor() {\r\n        this.gold = 0;\r\n        this.reward_min = 0;\r\n        this.endTime = 0;\r\n        this.startTime = 0;\r\n    }\r\n    setData(data) {\r\n        this.endTime = data.endTime;\r\n        this.reward_min = data.reward_min;\r\n        this.gold = data.gold;\r\n        this.dataServerFun();\r\n    }\r\n    saveData(data) {\r\n        data.endTime = this.endTime;\r\n        data.reward_min = this.reward_min;\r\n        data.gold = this.gold;\r\n    }\r\n    initData(data) {\r\n        this.startNewDay();\r\n        this.goldTimeStart();\r\n    }\r\n    initFun() {\r\n        this.startNewDay();\r\n        this.goldTimeStart();\r\n    }\r\n    loopFun() {\r\n        let ctime = Math.min(Laya.Browser.now(), this.endTime);\r\n        let now_min_time = this.getMinByTime(ctime);\r\n        if (this.reward_min != now_min_time) {\r\n            this.addGoldOnce();\r\n            this.reward_min = now_min_time;\r\n        }\r\n    }\r\n    dataServerFun() {\r\n        this.startTime = this.endTime - TimeGoldData.ONE_DAY;\r\n        let nowMin = 0;\r\n        if (this.endTime < Laya.Browser.now()) {\r\n            nowMin = this.getMinByTime(this.endTime);\r\n        }\r\n        else {\r\n            nowMin = this.getMinByTime(Laya.Browser.now());\r\n        }\r\n        let rgold = (nowMin - this.reward_min) * this.getOneGold();\r\n        this.reward_min = nowMin;\r\n        this.setGold(this.gold + rgold);\r\n        this.goldTimeStart();\r\n    }\r\n    goldTimeStart() {\r\n        Laya.timer.frameLoop(1, this, this.loopFun);\r\n    }\r\n    rewardGold(useAd) {\r\n        let agold = this.gold;\r\n        if (useAd) {\r\n            agold = this.gold * 3;\r\n        }\r\n        Session.homeData.changeGold(GoldType.GOLD, agold);\r\n        this.setGold(0);\r\n        if (this.endTime <= Laya.Browser.now()) {\r\n            this.startNewDay();\r\n        }\r\n        Session.saveData();\r\n    }\r\n    startNewDay() {\r\n        this.endTime = Laya.Browser.now() + TimeGoldData.ONE_DAY;\r\n        this.startTime = this.endTime - TimeGoldData.ONE_DAY;\r\n        this.reward_min = 0;\r\n    }\r\n    getMinByTime(time) {\r\n        let t = time - this.startTime;\r\n        return Math.floor(t / (60 * 1000));\r\n    }\r\n    getNowTime() {\r\n        if (this.endTime < Laya.Browser.now()) {\r\n            return [0, 0, 0, 0];\r\n        }\r\n        let t = this.endTime - Laya.Browser.now();\r\n        let arr = this.getLeft(t, 3600 * 1000);\r\n        let hour = arr[0];\r\n        arr = this.getLeft(arr[1], 60 * 1000);\r\n        let min = arr[0];\r\n        arr = this.getLeft(arr[1], 1000);\r\n        let second = arr[0];\r\n        arr = this.getLeft(arr[1], 1);\r\n        let ms = arr[0];\r\n        return [hour, min, second, ms];\r\n    }\r\n    addGoldOnce() {\r\n        this.setGold(this.gold + this.getOneGold());\r\n        this.reward_min = this.getMinByTime(Laya.Browser.now());\r\n        Session.saveData();\r\n    }\r\n    getOneGold() {\r\n        let max = Session.homeData.chapterId;\r\n        let addGold = Math.ceil(max / 2 + 1);\r\n        addGold = 2;\r\n        addGold = addGold * (1 + Session.talentData.offlineGold);\r\n        addGold = parseInt(addGold + \"\");\r\n        return addGold;\r\n    }\r\n    setGold(value) {\r\n        this.gold = value;\r\n    }\r\n    getLeft(t, v) {\r\n        let a = parseInt((t / v) + \"\");\r\n        let b = t - a * v;\r\n        return [a, b];\r\n    }\r\n}\r\nTimeGoldData.ONE_DAY = 24 * 60 * 60 * 1000;\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/game/data/IData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HomeData.ts"
  ]
}
