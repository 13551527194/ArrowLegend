{
  "code": "import GameEvent from \"../../main/GameEvent\";\r\nimport { TopUI } from \"../../main/scene/main/MainUI\";\r\nimport Game from \"../Game\";\r\nimport App from \"../../core/App\";\r\nimport SysHero from \"../../main/sys/SysHero\";\r\nimport Session from \"../../main/Session\";\r\nimport { Guide_Type } from \"../../main/guide/GuideManager\";\r\nimport Log from \"../../Log\";\r\nexport default class HomeData {\r\n    constructor() {\r\n        this.redDiamond = 0;\r\n        this.blueDiamond = 0;\r\n        this.playerExp = 0;\r\n        this.isPass = false;\r\n        this.newStat = 0;\r\n        this.openId = -1;\r\n        this.loginTime = 0;\r\n        this.adTimes = 0;\r\n        this.adPower = 0;\r\n        this.openBtn = [];\r\n        Laya.stage.on(GameEvent.NEW_DAY, this, this.newDayFun);\r\n        Laya.stage.on(GameEvent.AD_OVER, this, this.adOverFun);\r\n        Laya.stage.on(GameEvent.PASS_CHAPTER, this, this.openFun);\r\n    }\r\n    setNewStat(value) {\r\n        Log.log(value);\r\n    }\r\n    openFun() {\r\n        this.openId = Session.homeData.chapterId;\r\n    }\r\n    adOverFun() {\r\n        this.adTimes++;\r\n    }\r\n    newDayFun() {\r\n        this.adPower = 0;\r\n    }\r\n    setChapterId(value, index) {\r\n        this.chapterId = value;\r\n        Session.rankData.saveWorldRank();\r\n        Session.rankData.saveFriendRank();\r\n    }\r\n    setData(data) {\r\n        this.totalEnergy = data.totalEnergy;\r\n        this.maxEngergy = data.maxEngergy;\r\n        this.lastTime = data.lastTime;\r\n        this.curEnergy = data.curEnergy;\r\n        this.chapterId = data.chapterId;\r\n        this.mapIndex = data.mapIndex;\r\n        this.battleLv = data.battleLv;\r\n        this.playerLv = data.playerLv;\r\n        this.coins = data.coins;\r\n        this.blueDiamond = (data.blueDiamond ? data.blueDiamond : 0);\r\n        this.redDiamond = (data.redDiamond ? data.redDiamond : 0);\r\n        this.playerExp = data.playerExp;\r\n        this.isGuide = data.isGuide;\r\n        if (this.playerExp == null) {\r\n            this.playerExp = 0;\r\n        }\r\n        if (Date.now() >= this.lastTime) {\r\n            this.curEnergy = this.totalEnergy;\r\n        }\r\n        else {\r\n            let deltaTime = this.lastTime - Date.now();\r\n            let time = Math.floor(deltaTime / 1000);\r\n            let delta = Math.ceil(time / TopUI.TOTAL_TIME);\r\n            this.curEnergy = this.totalEnergy - delta;\r\n            console.log(\"Session剩余的时间\", time, this.curEnergy);\r\n        }\r\n        this.curEnergy = 20;\r\n        this.newStat = (data.newStat ? data.newStat : Guide_Type.over);\r\n        if (data.openBtn == null) {\r\n            this.openBtn = [\"1\", \"1\", \"1\", \"-1\", \"1\"];\r\n        }\r\n        else {\r\n            this.openBtn = data.openBtn.split(\",\");\r\n        }\r\n        this.adPower = (data.adPower ? data.adPower : 0);\r\n        if (data.loginTime == null) {\r\n            App.sendEvent(GameEvent.NEW_DAY);\r\n        }\r\n        else {\r\n            let last = new Date(data.loginTime);\r\n            let now = new Date();\r\n            if (now.getDate() != last.getDate()) {\r\n                App.sendEvent(GameEvent.NEW_DAY);\r\n            }\r\n        }\r\n        this.timeFun(0);\r\n        data.loginTime = Date.now();\r\n        this.adTimes = (data.adTimes ? data.adTimes : 0);\r\n    }\r\n    timeFun(send) {\r\n        if (send == 1) {\r\n            App.sendEvent(GameEvent.NEW_DAY);\r\n        }\r\n        let now = new Date();\r\n        let h = 60 * 60 * 1000;\r\n        let time = 24 * h - now.getHours() * h - now.getMinutes() * 60 * 1000 - now.getSeconds() * 1000;\r\n        Laya.timer.once(time + 1000, this, this.timeFun, [1]);\r\n    }\r\n    saveData(data) {\r\n        data.curEnergy = this.curEnergy;\r\n        data.maxEngergy = this.maxEngergy;\r\n        data.lastTime = this.lastTime;\r\n        data.totalEnergy = this.totalEnergy;\r\n        data.battleLv = this.battleLv;\r\n        data.playerLv = this.playerLv;\r\n        data.coins = this.coins;\r\n        data.blueDiamond = this.blueDiamond;\r\n        data.redDiamond = this.redDiamond;\r\n        data.playerExp = this.playerExp;\r\n        data.chapterId = this.chapterId;\r\n        data.mapIndex = this.mapIndex;\r\n        console.log(\"当前的层数\", data.mapIndex);\r\n        if (Game.battleLoader.chapterId >= this.chapterId) {\r\n            if (Game.battleLoader.index > this.mapIndex) {\r\n                data.mapIndex = Game.battleLoader.index - 1;\r\n                data.mapIndex = Math.max(0, data.mapIndex);\r\n                console.log(\"存储最高层数\", data.mapIndex);\r\n            }\r\n        }\r\n        data.isGuide = this.isGuide;\r\n        data.newStat = this.newStat;\r\n        data.openBtn = this.openBtn.join(\",\");\r\n        data.adPower = this.adPower;\r\n        data.adTimes = this.adTimes;\r\n    }\r\n    initData(data) {\r\n        this.totalEnergy = TopUI.MAX_ENERGY;\r\n        this.maxEngergy = TopUI.MAX_ENERGY;\r\n        this.curEnergy = this.totalEnergy;\r\n        this.lastTime = 0;\r\n        this.isGuide = true;\r\n        this.chapterId = 0;\r\n        this.mapIndex = 0;\r\n        this.battleLv = 1;\r\n        this.playerLv = 1;\r\n        this.coins = 0;\r\n        this.redDiamond = 10;\r\n        this.playerExp = 0;\r\n        this.blueDiamond = 10;\r\n        this.coins = 1000;\r\n        this.newStat = 1;\r\n        this.openBtn = [\"1\", \"-1\", \"-1\", \"-1\", \"1\"];\r\n        this.adPower = 0;\r\n        this.adTimes = 0;\r\n    }\r\n    changeGold(type, value, useType = 0) {\r\n        let num = this.getGoldByType(type);\r\n        if ((num + value) < 0) {\r\n            return false;\r\n        }\r\n        this.setGoldByType(type, value);\r\n        Laya.stage.event(GameEvent.GOLD_CHANGE);\r\n        return true;\r\n    }\r\n    getGoldByType(type) {\r\n        if (type == GoldType.GOLD) {\r\n            return this.coins;\r\n        }\r\n        else if (type == GoldType.RED_DIAMONG) {\r\n            return this.redDiamond;\r\n        }\r\n        else if (type == GoldType.BLUE_DIAMONG) {\r\n            return this.blueDiamond;\r\n        }\r\n    }\r\n    setGoldByType(type, value) {\r\n        if (type == GoldType.GOLD) {\r\n            this.coins += value;\r\n        }\r\n        else if (type == GoldType.RED_DIAMONG) {\r\n            this.redDiamond += value;\r\n        }\r\n        else if (type == GoldType.BLUE_DIAMONG) {\r\n            this.blueDiamond += value;\r\n        }\r\n    }\r\n    addPlayerExp(exp) {\r\n        this.playerExp += exp;\r\n        while (true) {\r\n            let sys = App.tableManager.getDataByNameAndId(SysHero.NAME, this.playerLv);\r\n            if (this.playerExp >= sys.roleExp) {\r\n                let nowLv = this.playerLv + 1;\r\n                if (App.tableManager.getDataByNameAndId(SysHero.NAME, this.playerLv) == null) {\r\n                    break;\r\n                }\r\n                this.playerLv = nowLv;\r\n                this.playerExp -= sys.roleExp;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n        App.sendEvent(GameEvent.PLAYER_INFO_UPDATE);\r\n    }\r\n}\r\nexport var GoldType;\r\n(function (GoldType) {\r\n    GoldType[GoldType[\"GOLD\"] = 0] = \"GOLD\";\r\n    GoldType[GoldType[\"RED_DIAMONG\"] = 1] = \"RED_DIAMONG\";\r\n    GoldType[GoldType[\"BLUE_DIAMONG\"] = 2] = \"BLUE_DIAMONG\";\r\n})(GoldType || (GoldType = {}));\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/game/data/IData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/main/MainUI.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/Game.ts",
    "D:/GirlGunGame/GirlGunGame/src/UseGoldType.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/App.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysHero.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysMap.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/guide/GuideManager.ts",
    "D:/GirlGunGame/GirlGunGame/src/Log.ts"
  ]
}
