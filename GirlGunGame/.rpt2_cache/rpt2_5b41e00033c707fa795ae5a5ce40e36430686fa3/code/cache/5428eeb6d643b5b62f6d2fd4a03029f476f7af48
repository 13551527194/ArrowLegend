{
  "code": "var Sprite3D = Laya.Sprite3D;\r\nimport GameBG from \"./GameBG\";\r\nimport BattleLoader from \"../main/scene/battle/BattleLoader\";\r\nimport App from \"../core/App\";\r\nimport HeadTranslateScript from \"./controllerScript/HeadTranslateScript\";\r\nimport FootRotateScript from \"./controllerScript/FootRotateScript\";\r\nimport SceneManager from \"../main/SceneManager\";\r\nimport ShakeUtils from \"../core/utils/ShakeUtils\";\r\nimport CoinEffect from \"./effect/CoinEffect\";\r\nimport PlayerSkillManager from \"./PlayerSkillManager\";\r\nimport Session from \"../main/Session\";\r\nimport BuffManager from \"./buff/BuffManager\";\r\nimport CookieKey from \"../gameCookie/CookieKey\";\r\nimport SysMap from \"../main/sys/SysMap\";\r\nimport GameEvent from \"../main/GameEvent\";\r\nimport SysChapter from \"../main/sys/SysChapter\";\r\nimport Coin from \"./player/Coin\";\r\nimport LogType from \"../core/manager/LogType\";\r\nimport GameCube from \"../main/scene/battle/GameCube\";\r\nexport default class Game {\r\n    constructor() {\r\n    }\r\n    static selectEnemy(pro) {\r\n        Game.e0_ = pro;\r\n        let curScale = pro.sysEnemy.zoomMode / 100;\r\n        curScale = 1 / curScale;\r\n        if (Game.e0_.sp3d && Game.e0_.sp3d.transform) {\r\n            Game.e0_.sp3d.addChild(Game.selectFoot);\r\n            Game.e0_.addSprite3DToChild(\"guadian\", Game.selectHead);\r\n            Game.selectHead.transform.localScaleX = curScale;\r\n            Game.selectHead.transform.localScaleY = curScale;\r\n            Game.selectHead.transform.localScaleZ = curScale;\r\n            Game.selectFoot.transform.localScaleX = curScale;\r\n            Game.selectFoot.transform.localScaleY = curScale;\r\n            Game.selectFoot.transform.localScaleZ = curScale;\r\n        }\r\n        else {\r\n        }\r\n    }\r\n    static updateMap() {\r\n        if (Game.map0) {\r\n            if (Game.bg) {\r\n                Game.bloodLayer.pos(Game.bg.x, Game.bg.y);\r\n                Game.frontLayer.pos(Game.bg.x, Game.bg.y);\r\n                Game.footLayer.pos(Game.bg.x, Game.bg.y);\r\n                Game.topLayer.pos(Game.bg.x, Game.bg.y);\r\n                Game.map0.pos(Game.bg.x, Game.bg.y);\r\n            }\r\n        }\r\n    }\r\n    static openDoor() {\r\n        if (Game.isOpen) {\r\n            return;\r\n        }\r\n        App.sdkManager.log(LogType.CHAPTER_INDEX, Game.battleLoader.index + \"\");\r\n        console.log(\"开门\");\r\n        if (Game.battleLoader.index >= SysMap.getTotal(Game.battleLoader.chapterId) && Game.battleLoader._configId != 100000) {\r\n            console.log(\"通关了\");\r\n            Session.homeData.isPass = true;\r\n            if (Game.battleLoader.chapterId >= Session.homeData.chapterId) {\r\n                Session.homeData.chapterId++;\r\n                Session.homeData.setChapterId(Session.homeData.chapterId, 0);\r\n            }\r\n            Game.battleLoader.index = 0;\r\n            Session.homeData.mapIndex = 0;\r\n        }\r\n        Game.cookie.setCookie(CookieKey.CURRENT_BATTLE, {\r\n            \"mapId\": Game.battleLoader.mapId,\r\n            \"index\": Game.battleLoader.index,\r\n            \"configId\": Game.battleLoader._configId,\r\n            \"curhp\": Game.hero.gamedata.hp,\r\n            \"maxhp\": Game.hero.gamedata.maxhp,\r\n            \"skills\": Game.skillManager.skills,\r\n            \"coins\": Game.battleCoins,\r\n            \"chapterId\": Game.battleLoader.chapterId\r\n        });\r\n        Game.isOpen = true;\r\n        if (Session.homeData.isGuide) {\r\n            Session.homeData.chapterId = 1;\r\n            Game.scenneM.battle.setGuide(\"通过传送进入下一关。\", 5);\r\n            App.sdkManager.log(LogType.BATTLE_GUIDE, \"通过传送进入下一关\");\r\n            Session.homeData.isGuide = false;\r\n            Game.battleLoader.index = 1;\r\n            Game.battleLoader.chapterId = 1;\r\n            SysChapter.randomDiamond(Game.battleLoader.chapterId);\r\n            Session.homeData.setChapterId(Session.homeData.chapterId, 1);\r\n        }\r\n        else {\r\n            if (!Session.homeData.isPass) {\r\n                Game.battleLoader.index++;\r\n                if (Game.battleLoader.chapterId == Session.homeData.chapterId) {\r\n                    if (Session.homeData.mapIndex < Game.battleLoader.index) {\r\n                        Session.homeData.mapIndex = Game.battleLoader.index - 1;\r\n                        Session.homeData.setChapterId(Session.homeData.chapterId, Session.homeData.mapIndex);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        Game.bg.setDoor(1);\r\n        Game.layer3d.addChild(Game.door);\r\n        Game.map0.setDoor(true);\r\n        Game.shakeBattle();\r\n        Game.battleLoader.clearMonster(true);\r\n        Session.saveData();\r\n    }\r\n    static shakeBattle() {\r\n        Game.scenneM.battle.pos(0, 0);\r\n        ShakeUtils.execute(Game.scenneM.battle, 75, 4);\r\n    }\r\n    static closeDoor() {\r\n        console.log(\"关门====================\");\r\n        Game.isOpen = false;\r\n        Game.door && Game.door.removeSelf();\r\n        Game.map0.setDoor(false);\r\n        Game.bg.setDoor(0);\r\n    }\r\n    static setSelectEffect() {\r\n        if (!Game.selectHead) {\r\n            Game.selectHead = Laya.Sprite3D.instantiate(Laya.loader.getRes(\"h5/effects/head/monster.lh\"));\r\n            Game.selectHead.addComponent(HeadTranslateScript);\r\n        }\r\n        if (!Game.selectFoot) {\r\n            Game.selectFoot = Laya.Sprite3D.instantiate(Laya.loader.getRes(\"h5/effects/foot/hero.lh\"));\r\n            Game.selectFoot.addComponent(FootRotateScript);\r\n        }\r\n    }\r\n    static reset() {\r\n        Game.state = 0;\r\n        Game.isPopupSkill = 0;\r\n        Game.bloodLayer.removeChildren();\r\n        Game.frontLayer.removeChildren();\r\n        Game.footLayer.removeChildren();\r\n        Game.layer3d.removeChildren();\r\n        Game.topLayer.removeChildren();\r\n        Game.selectHead && Game.selectHead.removeSelf();\r\n        Game.selectFoot && Game.selectFoot.removeSelf();\r\n        Game.map0.reset();\r\n        Game.e0_ = null;\r\n        Game.executor && Game.executor.stop_();\r\n        if (Game.ro) {\r\n            Game.ro.destroy();\r\n        }\r\n    }\r\n    static getRandPos(pro, range1 = 4) {\r\n        let mRow = Math.floor(pro.hbox.y / GameBG.ww);\r\n        let mCol = Math.floor(pro.hbox.x / GameBG.ww);\r\n        let range = range1;\r\n        var info = Game.map0.info;\r\n        var arr = [];\r\n        for (let i = mRow - range; i <= mRow + range; i++) {\r\n            if (i <= 3 || i >= GameBG.MAP_ROW - 3) {\r\n                continue;\r\n            }\r\n            for (let j = mCol - range; j <= mCol + range; j++) {\r\n                if (j == mRow && i == mCol) {\r\n                    continue;\r\n                }\r\n                if (j <= 1 || j >= GameBG.MAP_COL - 1) {\r\n                    continue;\r\n                }\r\n                var key = info[i + \"_\" + j];\r\n                if (key == null) {\r\n                    continue;\r\n                }\r\n                if (key == 0) {\r\n                    let aaa = [j, i];\r\n                    arr.push(aaa);\r\n                }\r\n            }\r\n        }\r\n        var toArr = [];\r\n        if (arr.length > 0) {\r\n            var rand = Math.floor(arr.length * Math.random());\r\n            toArr = arr[rand];\r\n        }\r\n        if (toArr.length == 0) {\r\n            toArr = [mRow, mCol];\r\n        }\r\n        return toArr;\r\n    }\r\n    static showMain() {\r\n        GameCube.recover();\r\n        Game.selectFoot && Game.selectFoot.removeSelf();\r\n        Game.selectHead && Game.selectHead.removeSelf();\r\n        Game.skillManager.clear();\r\n        Game.battleLoader.index = 1;\r\n        Game.rebornTimes = 2;\r\n        if (Game.hero) {\r\n            Game.hero.resetBlood();\r\n            Game.hero.resetSkill();\r\n            Game.hero.resetAI();\r\n        }\r\n        Game.battleExp = Game.heroExp = 0;\r\n        Game.battleLoader.clearMonster();\r\n        Game.scenneM.showMain();\r\n        if (Game.map0) {\r\n            Game.map0.Eharr.length = 0;\r\n        }\r\n        Game.AiArr.length = 0;\r\n        Game.playBgMusic();\r\n        if (Game.showCoinsNum > 0) {\r\n            Game.showCoinsNum = Game.showCoinsNum + Math.floor(Game.showCoinsNum * Session.talentData.lineGold / 100);\r\n            Laya.stage.event(GameEvent.ADD_COIN, Game.showCoinsNum);\r\n            Game.showCoinsNum = 0;\r\n        }\r\n        Game.showBlueNum = Game.showRedNum = 0;\r\n        Laya.stage.event(GameEvent.SHOW_MAIN);\r\n    }\r\n    static playBgMusic() {\r\n        Game.playMusic(\"menu.mp3\");\r\n    }\r\n    static playBattleMusic() {\r\n        Game.playMusic(\"state_fight.mp3\");\r\n    }\r\n    static playMusic(str) {\r\n        Game.cookie.getCookie(CookieKey.MUSIC_SWITCH, (res) => {\r\n            if (res == null || res.state == 1) {\r\n                App.soundManager.play(str, true);\r\n            }\r\n        });\r\n    }\r\n    static playSound(str) {\r\n        Game.cookie.getCookie(CookieKey.SOUND_SWITCH, (res) => {\r\n            if (res.state == 1) {\r\n                App.soundManager.play(str);\r\n            }\r\n        });\r\n    }\r\n    static dropDiamond(pro) {\r\n        Game.showBlueNum = Game.showRedNum = 0;\r\n        if (Game.map0.Eharr.length == 0) {\r\n            if (Game.battleLoader.index == SysChapter.dropIndex) {\r\n                if (SysChapter.blueNum > 0) {\r\n                    CoinEffect.addEffect(pro, SysChapter.blueNum, Coin.TYPE_BLUE);\r\n                }\r\n                else if (SysChapter.redNum > 0) {\r\n                    CoinEffect.addEffect(pro, SysChapter.redNum, Coin.TYPE_RED);\r\n                }\r\n            }\r\n            if (Game.battleLoader.index == SysChapter.heartIndex) {\r\n                if (SysChapter.heartNum > 0) {\r\n                    CoinEffect.addEffect(pro, SysChapter.heartNum, Coin.TYPE_HEART);\r\n                    setTimeout(() => {\r\n                        CoinEffect.flyHeart();\r\n                    }, 1000);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nGame.codeVer = \"2.1.1.10111358\";\r\nGame.resVer = \"2.1.1.10111358\";\r\nGame.nativefiles = [\r\n    \"loading/jianduxia.png\",\r\n    \"loading/jiandushang.png\",\r\n    \"loading/jiazai.jpg\",\r\n    \"loading/btn_kaishi.png\",\r\n    \"loading/dan.png\",\r\n    \"loading/loadingClip.png\",\r\n    \"loading/logo.png\",\r\n    \"loading/shouci.png\",\r\n    \"loading/zhudi.jpg\"\r\n];\r\nGame.userHeadUrl = \"\";\r\nGame.userName = \"\";\r\nGame.poolTagArr = {};\r\nGame.isStartBattle = false;\r\nGame.TestShooting = 0;\r\nGame.BigMapMode = 1;\r\nGame.state = 0;\r\nGame.isPopupSkill = 0;\r\nGame.rebornTimes = 2;\r\nGame.Event_MAIN_DIE = \"Event_MAIN_DIE\";\r\nGame.Event_PlayStop = \"Game.Event_PlayStop\";\r\nGame.Event_Short = \"Game.Event_Short\";\r\nGame.Event_Hit = \"Game.Event_Hit\";\r\nGame.Event_KeyNum = \"Game.Event_KeyNum\";\r\nGame.Event_ADD_HP = \"Event_ADD_HP\";\r\nGame.Event_UPDATE_ATTACK_SPEED = \"Event_UPDATE_ATTACK_SPEED\";\r\nGame.Event_NPC = \"Event_NPC\";\r\nGame.Event_COINS = \"Event_COINS\";\r\nGame.Event_EXP = \"Event_EXP\";\r\nGame.Event_LEVEL = \"Event_LEVEL\";\r\nGame.Event_SELECT_NEWSKILL = \"Event_SELECT_NEWSKILL\";\r\nGame.skillManager = new PlayerSkillManager();\r\nGame.AiArr = [];\r\nGame.HeroArrows = [];\r\nGame.layer3d = new Sprite3D();\r\nGame.layer3dCube = new Sprite3D();\r\nGame.layer3dCoins = new Sprite3D();\r\nGame.cameraY = 10;\r\nGame.sqrt3 = 10 * Math.sqrt(3);\r\nGame.footLayer = new Laya.Sprite();\r\nGame.bloodLayer = new Laya.Sprite();\r\nGame.frontLayer = new Laya.Sprite();\r\nGame.topLayer = new Laya.Sprite();\r\nGame.scenneM = new SceneManager();\r\nGame.buffM = new BuffManager();\r\nGame.battleLoader = new BattleLoader();\r\nGame.isOpen = false;\r\nGame.battleCoins = 0;\r\nGame.battleExp = 0;\r\nGame.heroExp = 0;\r\nGame.showCoinsNum = 0;\r\nGame.showBlueNum = 0;\r\nGame.showRedNum = 0;\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/game/GameBG.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/GameRocker.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/GameMap0.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/GamePro.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/GameExecut.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/GameCameraNum.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/battle/BattleLoader.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysEnemy.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/App.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/GameProType.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/ai/AttackType.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/move/MoveType.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/controllerScript/HeadTranslateScript.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/controllerScript/FootRotateScript.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/player/Monster.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/player/Hero.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/SceneManager.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/utils/ShakeUtils.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/effect/CoinEffect.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/PlayerSkillManager.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/buff/BuffManager.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameAlert.ts",
    "D:/GirlGunGame/GirlGunGame/src/gameCookie/BaseCookie.ts",
    "D:/GirlGunGame/GirlGunGame/src/gameCookie/CookieKey.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysMap.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysChapter.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/player/Coin.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/manager/LogType.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/battle/GameCube.ts"
  ]
}
