{
  "code": "import { ui } from \"../../../../ui/layaMaxUI\";\r\nimport App from \"../../../../core/App\";\r\nimport SysTalentInfo from \"../../../sys/SysTalentInfo\";\r\nimport Session from \"../../../Session\";\r\nimport FlyUpTips from \"../../../FlyUpTips\";\r\nimport GameEvent from \"../../../GameEvent\";\r\nimport SelectTalent from \"./SelectTalent\";\r\nimport TalentCell2 from \"./TalentCell2\";\r\nimport SysTalent from \"../../../sys/SysTalent\";\r\nimport GuideManager, { Guide_Type } from \"../../../guide/GuideManager\";\r\nimport GameMain from \"../../../GameMain\";\r\nexport default class TalentView extends ui.test.talentUI {\r\n    constructor() {\r\n        super();\r\n        this.imgArr = [\"tianfu/PTkuang.png\", \"tianfu/PTkuang.png\", \"tianfu/PTkuang.png\",\r\n            \"tianfu/JYkuang.png\", \"tianfu/JYkuang.png\", \"tianfu/JYkuang.png\",\r\n            \"tianfu/SSkuang.png\", \"tianfu/SSkuang.png\", \"tianfu/SSkuang.png\"];\r\n        this.list.itemRender = TalentCell2;\r\n        this.on(Laya.Event.DISPLAY, this, this.disFun);\r\n        this.shengmingniu.clickHandler = new Laya.Handler(this, this.btnFun);\r\n        Laya.stage.on(GameEvent.TALENT_UPDATE, this, this.tFun);\r\n        this.list.renderHandler = new Laya.Handler(this, this.renderFun);\r\n    }\r\n    selectFun(index) {\r\n        if (index == -1) {\r\n            this.tipBox.visible = false;\r\n            return;\r\n        }\r\n        this.tipBox.visible = true;\r\n        let b = this.list.getCell(index);\r\n        this.tipBox.x = this.list.x + b.x - 130;\r\n        this.tipBox.y = this.list.y + b.y + 200;\r\n        let arr = SysTalentInfo.getSys();\r\n        let sys = arr[index];\r\n        let tlv = Session.talentData.getLv(sys.id);\r\n        let sysT = App.tableManager.getDataByNameAndId(SysTalent.NAME, tlv);\r\n        let vv = sysT[sys.idName];\r\n        this.txt5.text = sys.talentInfo + \":\" + vv + \"%\";\r\n    }\r\n    renderFun(cell, index) {\r\n        let sys = this.list.getItem(index);\r\n        let obj = Session.talentData.getImgData(sys.id);\r\n        cell.logo1.skin = obj.logo;\r\n        cell.bg1.skin = this.imgArr[index];\r\n        cell.txtImg.skin = obj.font;\r\n        let lv = Session.talentData.getLv(sys.id);\r\n        cell.lv.value = lv + \"\";\r\n        cell.box1.visible = cell.box2.visible = false;\r\n        if (lv == 0) {\r\n            cell.box2.visible = true;\r\n        }\r\n        else {\r\n            cell.box1.visible = true;\r\n        }\r\n        cell.select.visible = (this.list.selectedIndex == index);\r\n        cell.on(Laya.Event.CLICK, this, this.cellClickFun, [cell, sys.id]);\r\n    }\r\n    cellClickFun(cell, tid) {\r\n        let lv = Session.talentData.getLv(tid);\r\n        if (lv == 0) {\r\n            this.tipBox.visible = false;\r\n            return;\r\n        }\r\n        this.tipBox.visible = true;\r\n        this.tipBox.x = this.list.x + cell.x - 60;\r\n        this.tipBox.y = this.list.y + cell.y + 200;\r\n        let sys = App.tableManager.getDataByNameAndId(SysTalentInfo.NAME, tid);\r\n        let sysT = App.tableManager.getDataByNameAndId(SysTalent.NAME, lv);\r\n        let vv = sysT[sys.idName];\r\n        this.txt5.text = sys.talentInfo + \":\" + vv + sys.getHou();\r\n    }\r\n    tFun() {\r\n        this.refresh();\r\n    }\r\n    btnFun() {\r\n        if (Session.talentData.canLvUp() == -2) {\r\n            FlyUpTips.setTips(\"请您提升君主等级\");\r\n            return;\r\n        }\r\n        if (Session.talentData.canLvUp() == -1) {\r\n            FlyUpTips.setTips(\"金币不够\");\r\n            App.dialogManager.open(GameMain.TIME_GOLD);\r\n            return;\r\n        }\r\n        Laya.MouseManager.enabled = false;\r\n        Laya.timer.once(300, null, () => {\r\n            Laya.MouseManager.enabled = true;\r\n        });\r\n        let d = new SelectTalent();\r\n        d.popup(false);\r\n    }\r\n    disFun() {\r\n        if (Session.homeData.newStat == Guide_Type.talent_lv_up) {\r\n            GuideManager.getInstance().hand(this.shengmingniu, this.shengmingniu.width / 2, this.shengmingniu.height / 2, Guide_Type.select_talent, 600);\r\n        }\r\n        this.tipBox.visible = false;\r\n        this.refresh();\r\n    }\r\n    refresh() {\r\n        let sysArr = SysTalentInfo.getSys();\r\n        this.list.array = sysArr;\r\n        this.shengmingniu.disabled = !Session.talentData.haveGold();\r\n        this.qianshu.value = Session.talentData.getGold() + \"\";\r\n        this.lvTime.text = \"已升级\" + Session.talentData.lvTimes + \"次\";\r\n    }\r\n    effect() {\r\n        this.list.mouseEnabled = false;\r\n        let len = this.list.cells.length;\r\n        for (let i = 0; i < len; i++) {\r\n            this.tw(this.list.cells[i], i * 100);\r\n        }\r\n        Laya.timer.once(len * 100 + 800, this, this.mouseFun);\r\n    }\r\n    mouseFun() {\r\n        this.list.mouseEnabled = true;\r\n    }\r\n    tw(cell, delay) {\r\n        let t = new Laya.Tween();\r\n        t.from(cell, { y: cell.y + this.list.height - cell.height }, 800 + delay, Laya.Ease.backIn, null);\r\n    }\r\n}\r\n",
  "references": [
    "D:/GirlGunGame/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/main/talent/TalentCell.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/App.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysTalentInfo.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/Session.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/FlyUpTips.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameEvent.ts",
    "D:/GirlGunGame/GirlGunGame/src/game/data/HomeData.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysTalentCost.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/main/talent/SelectTalent.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/scene/main/talent/TalentCell2.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/sys/SysTalent.ts",
    "D:/GirlGunGame/GirlGunGame/src/core/utils/MyEffect.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/guide/GuideManager.ts",
    "D:/GirlGunGame/GirlGunGame/src/main/GameMain.ts"
  ]
}
