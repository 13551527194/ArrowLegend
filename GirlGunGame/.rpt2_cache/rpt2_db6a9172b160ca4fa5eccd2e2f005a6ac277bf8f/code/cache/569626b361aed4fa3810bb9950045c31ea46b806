{
  "code": "import { ui } from \"./../../../ui/layaMaxUI\";\r\nimport Game from \"../../../game/Game\";\r\nimport SysLevel from \"../../sys/SysLevel\";\r\nimport App from \"../../../core/App\";\r\nimport SysMap from \"../../sys/SysMap\";\r\nimport GameEvent from \"../../GameEvent\";\r\nexport default class TopUI extends ui.test.battleUI {\r\n    constructor() {\r\n        super();\r\n        this.maskSpr = new Laya.Sprite();\r\n        this._indexBox = new IndexBox();\r\n        this.lastWidth = 0;\r\n        this.isTwo = false;\r\n        Laya.stage.on(Game.Event_COINS, this, this.updateCoins);\r\n        Laya.stage.on(Game.Event_EXP, this, this.updateExp);\r\n        this.indexBox.addChild(this._indexBox);\r\n        this.y = App.top + 60;\r\n        Laya.stage.on(GameEvent.BOOS_BLOOD_UPDATE, this, this.onUpdate);\r\n    }\r\n    onUpdate(hurt) {\r\n        this._curBlood -= hurt;\r\n        this._curBlood = Math.max(1, this._curBlood);\r\n        this.bossxue.scrollRect = new Laya.Rectangle(0, 0, this.bossxue.width * this._curBlood / this._bossEnemy.enemyHp, this.bossxue.height);\r\n    }\r\n    setBoss(isBoss, sys) {\r\n        this.boss.visible = isBoss;\r\n        this.bossxuetiao.visible = isBoss;\r\n        this._bossEnemy = sys;\r\n        if (!this._bossEnemy) {\r\n            return;\r\n        }\r\n        this._curBlood = this._bossEnemy.enemyHp;\r\n        if (this.bossxuetiao.visible) {\r\n            this.bossxue.scrollRect = new Laya.Rectangle(0, 0, this.bossxue.width, this.bossxue.height);\r\n        }\r\n    }\r\n    reset() {\r\n        this._indexBox.init();\r\n    }\r\n    updateIndex(index) {\r\n        this._indexBox.update(index);\r\n    }\r\n    updateExp() {\r\n        let lv = SysLevel.getLv(Game.battleExp);\r\n        let maxExp = SysLevel.getMaxExpByLv(lv);\r\n        let curExpSum = SysLevel.getExpSum(lv - 1);\r\n        let curExp = Game.battleExp - curExpSum;\r\n        let vv = curExp / maxExp;\r\n        this.isTwo = lv > Game.level;\r\n        Laya.timer.frameLoop(1, this, this.onLoop, [vv]);\r\n        Game.level = lv;\r\n        if (!this.isTwo) {\r\n        }\r\n    }\r\n    onLoop(vv) {\r\n        this.lastWidth += 15;\r\n        if (this.isTwo) {\r\n            if (this.lastWidth >= this.lvBar.height) {\r\n                this.lastWidth = 0;\r\n                this.isTwo = false;\r\n            }\r\n        }\r\n        else {\r\n            if (this.lastWidth >= this.lvBar.height * vv) {\r\n                this.lastWidth = this.lvBar.height * vv;\r\n                Laya.timer.clear(this, this.onLoop);\r\n            }\r\n        }\r\n        this.lastWidth = Math.max(1, this.lastWidth);\r\n        this.maskSpr.graphics.clear();\r\n        this.maskSpr.graphics.drawRect(0, this.lvBar.height - this.lastWidth, this.lvBar.width, this.lastWidth, \"#fff000\");\r\n        this.lvBar.mask = this.maskSpr;\r\n    }\r\n    updateCoins() {\r\n        this.jinbishu.value = \"\" + Game.showCoinsNum;\r\n    }\r\n    removeSelf() {\r\n        Game.state = 0;\r\n        return super.removeSelf();\r\n    }\r\n}\r\nexport class IndexBox extends ui.game.battleIndexBoxUI {\r\n    constructor() {\r\n        super();\r\n        this._cellList = [];\r\n        this._isInit = false;\r\n        this.scrollRect = new Laya.Rectangle(0, 0, this.width, this.height);\r\n    }\r\n    init() {\r\n        this._cellList.length = 0;\r\n        if (Game.battleLoader.chapterId == 0) {\r\n            return;\r\n        }\r\n        let max = SysMap.getTotal(Game.battleLoader.chapterId);\r\n        for (let i = 0; i < max; i++) {\r\n            let cell = Laya.Pool.getItemByClass(IndexCell.TAG, IndexCell);\r\n            cell.update(i + 1);\r\n            this.box.addChild(cell);\r\n            cell.x = 185 + i * 150;\r\n            cell.y = 55;\r\n            cell.gray = true;\r\n            this._cellList.push(cell);\r\n            cell.visible = false;\r\n        }\r\n    }\r\n    update(index) {\r\n        if (Game.battleLoader.chapterId == 0) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this._cellList.length; i++) {\r\n            this._cellList[i].visible = false;\r\n            if (index >= 2) {\r\n                if (i == index - 1 || i == index - 2 || i == index) {\r\n                    this._cellList[i].visible = true;\r\n                }\r\n            }\r\n            else {\r\n                this._cellList[0].visible = true;\r\n                this._cellList[1].visible = true;\r\n                this._cellList[2].visible = true;\r\n            }\r\n        }\r\n        let max = SysMap.getTotal(Game.battleLoader.chapterId);\r\n        if (index > max) {\r\n            index = max;\r\n        }\r\n        this.pbox1.visible = index != 1;\r\n        this.pbox2.visible = index != max;\r\n        if (!this._isInit) {\r\n            this.box.x = -(index - 1) * 150;\r\n            this._cellList[index - 1].scale(1.5, 1.5);\r\n            this._cellList[index - 1].gray = false;\r\n            this._isInit = true;\r\n            for (let i = 0; i < index - 1; i++) {\r\n                this._cellList[i].gray = false;\r\n            }\r\n            return;\r\n        }\r\n        Laya.Tween.to(this.box, { x: -(index - 1) * 150 }, 300, null, null, 100);\r\n        if (index == 1) {\r\n            Laya.Tween.to(this._cellList[index - 1], { scaleX: 1.5, scaleY: 1.5 }, 300, null, null, 100);\r\n        }\r\n        else {\r\n            Laya.Tween.to(this._cellList[index - 2], { scaleX: 1, scaleY: 1 }, 300, null, null, 100);\r\n            Laya.Tween.to(this._cellList[index - 1], { scaleX: 1.5, scaleY: 1.5 }, 300, null, null, 100);\r\n        }\r\n        this._cellList[index - 1].gray = false;\r\n    }\r\n}\r\nexport class IndexCell extends ui.test.battleLvUIUI {\r\n    constructor() {\r\n        super();\r\n        this.on(Laya.Event.UNDISPLAY, this, this.onUndis);\r\n    }\r\n    onUndis() {\r\n        Laya.Pool.recover(IndexCell.TAG, this);\r\n    }\r\n    set gray(value) {\r\n        this.btn.gray = value;\r\n    }\r\n    update(index) {\r\n        this.shuziyou.text = \"\" + index;\r\n    }\r\n}\r\nIndexCell.TAG = \"IndexCell\";\r\n",
  "references": [
    "D:/gitworker/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/gitworker/GirlGunGame/src/game/Game.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysLevel.ts",
    "D:/gitworker/GirlGunGame/src/core/utils/DisplayUtils.ts",
    "D:/gitworker/GirlGunGame/src/core/App.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysMap.ts",
    "D:/gitworker/GirlGunGame/src/main/Session.ts",
    "D:/gitworker/GirlGunGame/src/main/GameEvent.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysEnemy.ts"
  ]
}
