{
  "code": "import Game from \"../Game\";\r\nimport GameHitBox from \"../GameHitBox\";\r\nimport GameBG from \"../GameBG\";\r\nimport { GameAI } from \"./GameAI\";\r\nimport HeroBullet from \"../player/HeroBullet\";\r\nimport SysSkill from \"../../main/sys/SysSkill\";\r\nimport App from \"../../core/App\";\r\nimport Hero from \"../player/Hero\";\r\nexport default class Shooting {\r\n    constructor() {\r\n        this.scd = 0;\r\n        this.st = 0;\r\n        this.et = 0;\r\n        this.now = 0;\r\n        this.at = 0;\r\n        this.future = new GameHitBox(2, 2);\r\n    }\r\n    short_arrow(speed_, r_, pro, attackPower, bulletId = 20000) {\r\n        let bo = HeroBullet.getBullet(bulletId);\r\n        for (let i = 0; i < bo.buffAry.length; i++) {\r\n            let sys = App.tableManager.getDataByNameAndId(SysSkill.NAME, bo.buffAry[i]);\r\n            attackPower = attackPower * sys.damagePercent / 100;\r\n        }\r\n        bo.hurtValue = Math.floor(attackPower);\r\n        bo.sp3d.transform.localPositionY = 0.8;\r\n        bo.setXY2D(pro.pos2.x, pro.pos2.z);\r\n        bo.setSpeed(speed_);\r\n        bo.rotation(r_);\r\n        bo.gamedata.bounce = pro.gamedata.bounce;\r\n        bo.startAi();\r\n        Game.layer3d.addChild(bo.sp3d);\r\n        return bo;\r\n    }\r\n    attackOk() {\r\n        this.now = Game.executor.getWorldNow();\r\n        return this.now >= this.st;\r\n    }\r\n    starAttack(pro, acstr) {\r\n        this.pro = pro;\r\n        this.curAttack = acstr;\r\n        if (this.attackOk()) {\r\n            this.st = Game.executor.getWorldNow() + Hero.curHeroData.atkSpeed;\r\n            this.scd = 0;\r\n            this.pro.play(acstr);\r\n            if (this.at > 0) {\r\n                Laya.stage.timer.frameLoop(this.at, this, this.ac0);\r\n            }\r\n            else {\r\n                this.ac0();\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    cancelAttack() {\r\n        this.st = this.et;\r\n        this.scd = 0;\r\n        Laya.stage.timer.clear(this, this.ac0);\r\n    }\r\n    ac0() {\r\n        if (this.pro.normalizedTime >= this.at) {\r\n            if (this.pro.normalizedTime >= 1) {\r\n                Laya.stage.timer.clear(this, this.ac0);\r\n                this.pro.play(GameAI.Idle);\r\n            }\r\n            if (this.scd == 0) {\r\n                this.scd = 1;\r\n                this.st = Game.executor.getWorldNow() + Hero.curHeroData.atkSpeed;\r\n                this.pro.event(Game.Event_Short, this.curAttack);\r\n                this.et = this.st;\r\n            }\r\n        }\r\n    }\r\n    checkBallistic(n, pro, ero) {\r\n        var vx = GameBG.mw2 * Math.cos(n);\r\n        var vz = GameBG.mw2 * Math.sin(n);\r\n        var x0 = pro.hbox.cx;\r\n        var y0 = pro.hbox.cy;\r\n        var ebh;\r\n        for (let i = 0; i < 6000; i++) {\r\n            ebh = null;\r\n            this.future.setVV(x0, y0, vx, vz);\r\n            if (ero.hbox.hit(ero.hbox, this.future)) {\r\n                return ero;\r\n            }\r\n            var hits = Game.map0.Aharr;\r\n            ebh = Game.map0.chechHit_arr(this.future, hits);\r\n            if (ebh) {\r\n                return null;\r\n            }\r\n            x0 += vx;\r\n            y0 += vz;\r\n        }\r\n        return null;\r\n    }\r\n}\r\n",
  "references": [
    "D:/gitworker/GirlGunGame/src/game/Game.ts",
    "D:/gitworker/GirlGunGame/src/game/GameHitBox.ts",
    "D:/gitworker/GirlGunGame/src/game/GamePro.ts",
    "D:/gitworker/GirlGunGame/src/game/GameBG.ts",
    "D:/gitworker/GirlGunGame/src/game/ai/GameAI.ts",
    "D:/gitworker/GirlGunGame/src/game/player/HeroBullet.ts",
    "D:/gitworker/GirlGunGame/src/game/ai/HeroArrowAI.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysSkill.ts",
    "D:/gitworker/GirlGunGame/src/core/App.ts",
    "D:/gitworker/GirlGunGame/src/main/Session.ts",
    "D:/gitworker/GirlGunGame/src/game/player/Hero.ts"
  ]
}
