{
  "code": "import { ui } from \"../../ui/layaMaxUI\";\r\nimport App from \"../../core/App\";\r\nimport { AD_TYPE } from \"../../ADType\";\r\nimport Session from \"../Session\";\r\nimport { HeroLvType } from \"../../game/data/HeroData\";\r\nimport { GOLD_CHANGE_TYPE } from \"../../UseGoldType\";\r\nimport GetItemDialog from \"./GetItemDialog\";\r\nimport AdDiamond from \"./AdDiamond\";\r\nimport { GoldType } from \"../../game/data/HomeData\";\r\nexport default class NoResDialog extends ui.test.NoResDialogUI {\r\n    constructor() {\r\n        super();\r\n        this.goldType = 0;\r\n        this.addNum = 0;\r\n    }\r\n    setType(type) {\r\n        if (type == 0) {\r\n            this.vs.selectedIndex = 0;\r\n            this.l1.text = \"剩余次数:\" + Session.homeData.adPower + \"/3\";\r\n            this.title.text = \"体力不足\";\r\n            this.btnView.fuhuo.clickHandler = new Laya.Handler(this, this.playAdFun);\r\n        }\r\n        else {\r\n            this.vs.selectedIndex = 1;\r\n            if (type == NoResDialogType.red) {\r\n                this.title.text = \"红宝石不足\";\r\n                this.dia.vs.selectedIndex = 1;\r\n                this.setGoldType(GoldType.RED_DIAMONG);\r\n            }\r\n            else if (type == NoResDialogType.blue) {\r\n                this.title.text = \"蓝宝石不足\";\r\n                this.dia.vs.selectedIndex = 2;\r\n                this.setGoldType(GoldType.BLUE_DIAMONG);\r\n            }\r\n            this.btnView.fuhuo.on(Laya.Event.CLICK, this, this.ad2Fun);\r\n        }\r\n        this.btnView.ani1.play(0, true);\r\n    }\r\n    ad2Fun() {\r\n        if (this.check() > 0) {\r\n            return;\r\n        }\r\n        App.sdkManager.playAdVideo(AD_TYPE.AD_DIAMOND, new Laya.Handler(this, this.adFun));\r\n    }\r\n    adFun() {\r\n        let v = Math.ceil(Math.random() * 4) + 6;\r\n        this.addNum = v;\r\n        Session.homeData.changeGold(this.goldType, v, GOLD_CHANGE_TYPE.AD_DIAMOND);\r\n        let g = new GetItemDialog();\r\n        g.setData({ type: this.goldType, value: v });\r\n        g.popup(true);\r\n        g.once(Laya.Event.UNDISPLAY, this, this.undisFun);\r\n        let b = Session.heroData.getHeroBaseData(Session.heroData.nowRoleId);\r\n        if (this.heroType == HeroLvType.ATK) {\r\n            b.atkTime = Laya.Browser.now() + 60 * 1000;\r\n        }\r\n        else if (this.heroType == HeroLvType.HP) {\r\n            b.hpTime = Laya.Browser.now() + 60 * 1000;\r\n        }\r\n    }\r\n    setGoldType(a) {\r\n        this.goldType = a;\r\n        let res = this.check();\r\n        if (res < 0) {\r\n            this.fc.visible = false;\r\n        }\r\n        else {\r\n            this.fc.visible = true;\r\n            Laya.timer.frameLoop(1, this, this.loopFun);\r\n        }\r\n        this.on(Laya.Event.UNDISPLAY, this, this.aundisFun);\r\n    }\r\n    aundisFun() {\r\n        Laya.timer.clearAll(this);\r\n    }\r\n    loopFun() {\r\n        let res = this.check();\r\n        if (res < 0) {\r\n            this.fc.visible = false;\r\n            return;\r\n        }\r\n        else {\r\n            this.fc.value = \"00:\" + this.getV0(Math.ceil(res / 1000));\r\n        }\r\n    }\r\n    getV0(v) {\r\n        return ((v < 10) ? (\"0\" + v) : (\"\" + v));\r\n    }\r\n    check() {\r\n        let t = Session.heroData.getBaseTime(this.heroType, Session.heroData.nowRoleId);\r\n        return t - Laya.Browser.now();\r\n    }\r\n    undisFun() {\r\n        this.event(AdDiamond.CHANGE_GOLD_EVENT, [this.goldType, this.addNum]);\r\n    }\r\n    playAdFun() {\r\n        if (Session.homeData.adPower == 3) {\r\n            return;\r\n        }\r\n        App.sdkManager.playAdVideo(AD_TYPE.AD_POWER, new Laya.Handler(this, this.overFun));\r\n    }\r\n    overFun() {\r\n        Session.homeData.adPower++;\r\n        this.close();\r\n        Session.saveData();\r\n        Session.homeData.curEnergy = 20;\r\n        Session.homeData.lastTime = 0;\r\n    }\r\n}\r\nNoResDialog.CHANGE_GOLD_EVENT = \"CHANGE_GOLD_EVENT\";\r\nexport var NoResDialogType;\r\n(function (NoResDialogType) {\r\n    NoResDialogType[NoResDialogType[\"tili\"] = 0] = \"tili\";\r\n    NoResDialogType[NoResDialogType[\"red\"] = 1] = \"red\";\r\n    NoResDialogType[NoResDialogType[\"blue\"] = 2] = \"blue\";\r\n})(NoResDialogType || (NoResDialogType = {}));\r\n",
  "references": [
    "D:/gitworker/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/gitworker/GirlGunGame/src/core/App.ts",
    "D:/gitworker/GirlGunGame/src/ADType.ts",
    "D:/gitworker/GirlGunGame/src/main/Session.ts",
    "D:/gitworker/GirlGunGame/src/game/data/HeroData.ts",
    "D:/gitworker/GirlGunGame/src/UseGoldType.ts",
    "D:/gitworker/GirlGunGame/src/main/dialog/GetItemDialog.ts",
    "D:/gitworker/GirlGunGame/src/main/dialog/AdDiamond.ts",
    "D:/gitworker/GirlGunGame/src/game/data/HomeData.ts"
  ]
}
