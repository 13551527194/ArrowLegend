{
  "code": "import { ui } from \"../../../../ui/layaMaxUI\";\r\nimport Game from \"../../../../game/Game\";\r\nimport GameEvent from \"./../../../GameEvent\";\r\nimport SysChapter from \"../../../sys/SysChapter\";\r\nimport App from \"../../../../core/App\";\r\nimport Session from \"../../../Session\";\r\nimport WorldCell from \"./WorldCell\";\r\nimport GameMain from \"../../../GameMain\";\r\nimport MyTimeGold from \"../timegold/MyTimeGold\";\r\nimport FlyEffect from \"../../../../game/effect/FlyEffect\";\r\nimport FlyUpTips from \"../../../FlyUpTips\";\r\nimport { Guide_Type } from \"../../../guide/GuideManager\";\r\nimport OpenIconDialog from \"../../../guide/OpenIconDialog\";\r\nexport default class WorldView extends ui.test.worldUI {\r\n    constructor() {\r\n        super();\r\n        this.box1.y = this.box1.y + App.top;\r\n        this.box1.mouseThrough = true;\r\n        this.list = new Laya.List();\r\n        this.list.pos(this.box.x, this.box.y);\r\n        this.addChild(this.list);\r\n        this.list.itemRender = WorldCell;\r\n        this.list.size(Laya.stage.width, this.box.height);\r\n        this.list.vScrollBarSkin = \"\";\r\n        this.list.renderHandler = new Laya.Handler(this, this.updateItem);\r\n        this.on(Laya.Event.DISPLAY, this, this.onDis);\r\n        let myTime = new MyTimeGold();\r\n        myTime.setUI(this.timeLogo);\r\n        this.timeLogo.on(Laya.Event.CLICK, this, this.timeClickFun);\r\n        this.rankBtn.on(Laya.Event.CLICK, this, this.rankClickFun);\r\n        this.sign7Btn.on(Laya.Event.CLICK, this, this.sign7clickFun);\r\n        this.shareBtn.on(Laya.Event.CLICK, this, this.shareFun);\r\n        this.frogBtn.on(Laya.Event.CLICK, this, this.gotoFrog);\r\n        Laya.stage.on(GameEvent.ADD_COIN, this, this.addCoinFun);\r\n        Laya.stage.on(GameEvent.APP_ENERGY, this, this.reducePowerFun);\r\n        this.addChild(this.box1);\r\n        Laya.stage.on(GameEvent.SHOW_MAIN, this, this.showMain);\r\n    }\r\n    gotoFrog() {\r\n        if (Laya.Browser.window.wx) {\r\n            Laya.Browser.window.wx.navigateToMiniProgram({\r\n                appId: 'wx63d79f4642c0f508',\r\n                path: '',\r\n                envVersion: \"release\",\r\n                success(res) {\r\n                    console.log(\"按钮跳转小游戏成功\");\r\n                }\r\n            });\r\n        }\r\n    }\r\n    showMain() {\r\n        Laya.timer.once(600, null, () => {\r\n            if (Session.homeData.newStat == Guide_Type.click_talent) {\r\n                let dp = new OpenIconDialog(2);\r\n                dp.popup(false, false);\r\n            }\r\n            else if (Session.homeData.newStat == Guide_Type.open_role) {\r\n                let dp = new OpenIconDialog(1);\r\n                dp.popup(false, false);\r\n            }\r\n        });\r\n    }\r\n    reducePowerFun(v) {\r\n        let r = new ui.test.ReducePowerUI();\r\n        this.addChild(r);\r\n        r.fc.value = \"-\" + v;\r\n        let sp = WorldCell.clickCell.mapBtn;\r\n        let p = sp.localToGlobal(new Laya.Point(0, 0), true, this);\r\n        r.x = p.x + sp.width / 2;\r\n        r.y = p.y + sp.height / 2;\r\n        let t = new Laya.Tween();\r\n        t.to(r, { y: r.y - 200 }, 700, null, new Laya.Handler(this, this.rFun, [r]));\r\n    }\r\n    rFun(a) {\r\n        a.removeSelf();\r\n    }\r\n    shareFun() {\r\n        App.sdkManager.onlyShare();\r\n    }\r\n    sign7clickFun() {\r\n        FlyUpTips.setTips(\"敬请期待\");\r\n    }\r\n    addCoinFun(v) {\r\n        let last = Session.homeData.coins - v;\r\n        let fc = Game.scenneM.main.mainUI.topUI.coinClip;\r\n        fc.value = last + \"\";\r\n        let cell = this.list.getCell(0);\r\n        let fly = new FlyEffect();\r\n        fly.flyFromP(Laya.stage.width / 2, Laya.stage.height / 2, Game.scenneM.main.mainUI.topUI.goldImg, v, last, fc);\r\n    }\r\n    rankClickFun() {\r\n        App.dialogManager.open(GameMain.RANK_DIALOG);\r\n    }\r\n    timeClickFun() {\r\n        App.dialogManager.open(GameMain.TIME_GOLD);\r\n    }\r\n    updateItem(cell, index) {\r\n        let sysChapter = this.list.getItem(index);\r\n        if (sysChapter && sysChapter.id == Session.homeData.openId) {\r\n            cell.update(sysChapter, true);\r\n            cell.open();\r\n        }\r\n        else {\r\n            cell.update(sysChapter);\r\n        }\r\n    }\r\n    onDis() {\r\n        let indexTo = Session.homeData.chapterId - 1;\r\n        indexTo = Math.max(indexTo, 0);\r\n        let arr = App.tableManager.getTable(SysChapter.NAME);\r\n        let arr1 = arr.concat();\r\n        arr1.length = 3;\r\n        arr1.push(null);\r\n        this.list.array = arr1;\r\n        this.list.scrollTo(indexTo);\r\n        let cell = this.list.getCell(indexTo);\r\n        cell.mapBtn.scale(0.0, 0.0);\r\n        let t = new Laya.Tween();\r\n        t.to(cell.mapBtn, { scaleX: 1, scaleY: 1 }, 500, Laya.Ease.backOut, null, 200);\r\n        Session.homeData.openId = -1;\r\n    }\r\n}\r\n",
  "references": [
    "D:/gitworker/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/gitworker/GirlGunGame/src/game/GameBG.ts",
    "D:/gitworker/GirlGunGame/src/game/Game.ts",
    "D:/gitworker/GirlGunGame/src/main/GameEvent.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysChapter.ts",
    "D:/gitworker/GirlGunGame/src/core/App.ts",
    "D:/gitworker/GirlGunGame/src/main/Session.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysMap.ts",
    "D:/gitworker/GirlGunGame/src/game/GameCameraNum.ts",
    "D:/gitworker/GirlGunGame/src/main/scene/main/world/WorldCell.ts",
    "D:/gitworker/GirlGunGame/src/main/scene/main/timegold/TimeGoldDialog.ts",
    "D:/gitworker/GirlGunGame/src/main/GameMain.ts",
    "D:/gitworker/GirlGunGame/src/main/scene/main/timegold/MyTimeGold.ts",
    "D:/gitworker/GirlGunGame/src/game/effect/FlyEffect.ts",
    "D:/gitworker/GirlGunGame/src/main/FlyUpTips.ts",
    "D:/gitworker/GirlGunGame/src/main/guide/GuideManager.ts",
    "D:/gitworker/GirlGunGame/src/main/guide/OpenIconDialog.ts"
  ]
}
