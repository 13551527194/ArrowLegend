{
  "code": "import { ui } from \"./../../../../ui/layaMaxUI\";\r\nimport Game from \"../../../../game/Game\";\r\nimport Session from \"../../../Session\";\r\nimport SysHero from \"../../../sys/SysHero\";\r\nimport App from \"../../../../core/App\";\r\nimport GameEvent from \"../../../GameEvent\";\r\nimport { AD_TYPE } from \"../../../../ADType\";\r\nimport { GoldType } from \"../../../../game/data/HomeData\";\r\nimport CookieKey from \"../../../../gameCookie/CookieKey\";\r\nimport MyEffect from \"../../../../core/utils/MyEffect\";\r\nexport default class GameOverView extends ui.test.GameOverUI {\r\n    constructor() {\r\n        super();\r\n        this.maskSpr = new Laya.Sprite();\r\n        this.delayTime = 200;\r\n        this.lastWidth = 0;\r\n        App.sdkManager.initAdBtn(this.fuhuoBtn.fuhuo, AD_TYPE.AD_BATTLE10);\r\n        this.on(Laya.Event.DISPLAY, this, this.onDis);\r\n        this.on(Laya.Event.CLICK, this, this.onClick);\r\n    }\r\n    onRewardSuccess() {\r\n        Game.showCoinsNum = Game.showCoinsNum * 2;\r\n        Game.showBlueNum = Game.showBlueNum * 2;\r\n        Game.showRedNum = Game.showRedNum * 2;\r\n        this.lanzuan.value = \"+\" + Game.showBlueNum;\r\n        this.hongzuan.value = \"+\" + Game.showRedNum;\r\n        this.coinClip.value = \"+\" + Game.showCoinsNum;\r\n        let deltaNum = Math.floor(Game.showCoinsNum * Session.talentData.lineGold / 100);\r\n        this.deltaCoin.value = \"+\" + deltaNum;\r\n        this.deltaCoin.visible = deltaNum > 0;\r\n        Session.homeData.changeGold(GoldType.GOLD, Game.showCoinsNum);\r\n        Session.homeData.changeGold(GoldType.BLUE_DIAMONG, Game.showBlueNum);\r\n        Session.homeData.changeGold(GoldType.RED_DIAMONG, Game.showRedNum);\r\n        console.log(\"5倍奖励\", Game.showCoinsNum, Game.showBlueNum, Game.showRedNum);\r\n        Session.saveData();\r\n        setTimeout(() => {\r\n            this.onCloseView();\r\n        }, 300);\r\n    }\r\n    onCloseView() {\r\n        this.removeSelf();\r\n        Game.showMain();\r\n    }\r\n    onClick(e) {\r\n        if (e.target == this.fuhuoBtn.fuhuo) {\r\n            App.sdkManager.playAdVideo(AD_TYPE.AD_BATTLE10, new Laya.Handler(this, this.onRewardSuccess));\r\n        }\r\n        else {\r\n            this.removeSelf();\r\n            Game.showMain();\r\n        }\r\n    }\r\n    onDis() {\r\n        this.closeTxt.alpha = 0;\r\n        Game.cookie.removeCookie(CookieKey.CURRENT_BATTLE);\r\n        Laya.timer.frameLoop(1, this, this.onLoop);\r\n        Laya.MouseManager.enabled = false;\r\n        this.oldLv = Session.homeData.playerLv;\r\n        let sys = App.tableManager.getDataByNameAndId(SysHero.NAME, this.oldLv);\r\n        this.oldPercent = Session.homeData.playerExp / sys.roleExp;\r\n        this.oldPercent = Math.min(1, this.oldPercent);\r\n        this.lastWidth = this.expBar.width * this.oldPercent;\r\n        this.setmask();\r\n        let arr = SysHero.getNewLv(Game.heroExp);\r\n        this.newLv = arr[0];\r\n        this.newExp = arr[1];\r\n        sys = App.tableManager.getDataByNameAndId(SysHero.NAME, this.newLv);\r\n        this.newPercent = this.newExp / sys.roleExp;\r\n        this.newPercent = Math.min(1, this.newPercent);\r\n        this.bigBox.y = Laya.stage.height / 2;\r\n        this.lanBox.removeSelf();\r\n        this.ziBox.removeSelf();\r\n        this.coinBox.removeSelf();\r\n        this.lightView.visible = false;\r\n        this.topBox.visible = false;\r\n        this.expBox.visible = false;\r\n        this.lingqu.visible = false;\r\n        this.fuhuo.visible = false;\r\n        this.topBox.visible = true;\r\n        this.topBox.scale(2.5, 2.5);\r\n        this.topBox.alpha = 0;\r\n        Laya.Tween.to(this.topBox, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext));\r\n        this.cengshu.value = this.oldLv + \"\";\r\n        this.dengji.value = this.oldLv + \"\";\r\n    }\r\n    onNext() {\r\n        this.lightView.visible = true;\r\n        this.lightView.scale(2.5, 2.5);\r\n        this.lightView.alpha = 0;\r\n        Laya.Tween.to(this.lightView, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext1));\r\n    }\r\n    onNext1() {\r\n        this.expBox.visible = true;\r\n        this.updateExp();\r\n    }\r\n    updateExp() {\r\n        if (this.newLv == this.oldLv) {\r\n            Laya.Tween.to(this.bigBox, { y: 366 }, this.delayTime, null, new Laya.Handler(this, () => {\r\n                Laya.timer.frameLoop(1, this, this.onLoopExp);\r\n            }));\r\n        }\r\n        else {\r\n            Laya.timer.frameLoop(1, this, this.onLoopLv);\r\n        }\r\n    }\r\n    onLoopLv() {\r\n        this.lastWidth += 5;\r\n        if (this.lastWidth >= this.expBar.width) {\r\n            this.lastWidth = 0;\r\n            this.oldLv++;\r\n            this.cengshu.value = this.oldLv + \"\";\r\n            this.dengji.value = this.oldLv + \"\";\r\n            Laya.timer.clear(this, this.onLoopLv);\r\n            Laya.stage.event(GameEvent.LV_UP_VIEW);\r\n        }\r\n        this.setmask();\r\n    }\r\n    onLoopExp(vv) {\r\n        this.lastWidth += 5;\r\n        if (this.lastWidth >= this.expBar.width * this.newPercent) {\r\n            this.lastWidth = this.expBar.width * this.newPercent;\r\n            Laya.timer.clear(this, this.onLoopExp);\r\n            this.hh = 800;\r\n            this.lingqu.visible = true;\r\n            this.lingqu.scale(2.5, 2.5);\r\n            this.lingqu.alpha = 0;\r\n            Laya.Tween.to(this.lingqu, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext2));\r\n        }\r\n        this.setmask();\r\n    }\r\n    onNext2() {\r\n        if (Game.showBlueNum > 0) {\r\n            this.addChild(this.lanBox);\r\n            this.lanzuan.value = \"+\" + Game.showBlueNum;\r\n            this.lanBox.x = 375;\r\n            this.lanBox.y = this.hh;\r\n            this.hh += 100;\r\n            this.lanBox.visible = true;\r\n            this.lanBox.scale(2.5, 2.5);\r\n            this.lanBox.alpha = 0;\r\n            Laya.Tween.to(this.lanBox, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext3));\r\n        }\r\n        else {\r\n            this.onNext3();\r\n        }\r\n    }\r\n    onNext3() {\r\n        if (Game.showRedNum > 0) {\r\n            this.hongzuan.value = \"+\" + Game.showRedNum;\r\n            this.addChild(this.ziBox);\r\n            this.ziBox.x = 375;\r\n            this.ziBox.y = this.hh;\r\n            this.hh += 100;\r\n            this.ziBox.visible = true;\r\n            this.ziBox.scale(2.5, 2.5);\r\n            this.ziBox.alpha = 0;\r\n            Laya.Tween.to(this.ziBox, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext4));\r\n        }\r\n        else {\r\n            this.onNext4();\r\n        }\r\n    }\r\n    onNext4() {\r\n        if (Game.showCoinsNum > 0) {\r\n            this.coinClip.value = \"+\" + Game.showCoinsNum;\r\n            let deltaNum = Math.floor(Game.showCoinsNum * Session.talentData.lineGold / 100);\r\n            this.deltaCoin.value = \"+\" + deltaNum;\r\n            this.deltaCoin.visible = deltaNum > 0;\r\n            this.addChild(this.coinBox);\r\n            this.coinBox.x = 375;\r\n            this.coinBox.y = this.hh;\r\n            this.hh += 100;\r\n            this.coinBox.visible = true;\r\n            this.coinBox.scale(2.5, 2.5);\r\n            this.coinBox.alpha = 0;\r\n            Laya.Tween.to(this.coinBox, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext5));\r\n        }\r\n        else {\r\n            this.onNext5();\r\n        }\r\n    }\r\n    onNext5() {\r\n        this.fuhuo.y = this.hh - 30;\r\n        this.fuhuo.visible = true;\r\n        this.fuhuo.scale(2.5, 2.5);\r\n        this.fuhuo.alpha = 0;\r\n        Laya.Tween.to(this.fuhuo, { scaleX: 1, scaleY: 1, alpha: 1 }, this.delayTime, null, new Laya.Handler(this, this.onNext6));\r\n    }\r\n    onNext6() {\r\n        Session.homeData.addPlayerExp(Game.heroExp);\r\n        Session.saveData();\r\n        Laya.MouseManager.enabled = true;\r\n        this.closeTxt.alpha = 1;\r\n        MyEffect.flash(this.closeTxt);\r\n    }\r\n    setmask() {\r\n        this.lastWidth = Math.max(1, this.lastWidth);\r\n        this.maskSpr.graphics.clear();\r\n        this.maskSpr.graphics.drawRect(0, 0, this.lastWidth, this.expBar.height, \"#fff000\");\r\n        this.expBar.mask = this.maskSpr;\r\n    }\r\n    onLoop() {\r\n        this.lightView.rotation++;\r\n    }\r\n    removeSelf() {\r\n        Laya.timer.clear(this, this.onLoop);\r\n        Game.state = 0;\r\n        return super.removeSelf();\r\n    }\r\n}\r\n",
  "references": [
    "D:/gitworker/GirlGunGame/src/ui/layaMaxUI.ts",
    "D:/gitworker/GirlGunGame/src/game/Game.ts",
    "D:/gitworker/GirlGunGame/src/main/Session.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysHero.ts",
    "D:/gitworker/GirlGunGame/src/core/App.ts",
    "D:/gitworker/GirlGunGame/src/main/scene/battle/gameOver/LvUpView.ts",
    "D:/gitworker/GirlGunGame/src/main/GameEvent.ts",
    "D:/gitworker/GirlGunGame/src/main/sys/SysChapter.ts",
    "D:/gitworker/GirlGunGame/src/ADType.ts",
    "D:/gitworker/GirlGunGame/src/game/data/HomeData.ts",
    "D:/gitworker/GirlGunGame/src/gameCookie/CookieKey.ts",
    "D:/gitworker/GirlGunGame/src/core/utils/MyEffect.ts"
  ]
}
